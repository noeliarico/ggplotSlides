---
title: "Visualizaci√≥n de datos para la transferencia \\ de resultados en distintos √°mbitos cient√≠ficos"
subtitle: "INIE - Formaci√≥n PDI \n UniOvi"  
author: 
  - "Noelia Rico \n Departamento de Inform√°tica"
date: '5-6 JULIO 2021'
output:
  xaringan::moon_reader:
    lib_dir: libs
    css: xaringan-themer.css
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{r setup, include=FALSE}
library(tidyverse)
library(palmerpenguins)
library(babynames)
library(gapminder)
library(gganimate)
library(plotly)
library(gifski)
options(htmltools.dir.version = FALSE)
options(htmltools.preserve.raw = FALSE)
knitr::opts_chunk$set(fig.retina = 3, fig.align = 'center', warning = FALSE, message = FALSE)
```

```{r xaringan-themer, include=FALSE, warning=FALSE}

library(xaringanthemer)
style_mono_accent(
  base_color = "#1c5253",
  # header_font_google = google_font("Josefin Sans"),
  header_font_google = google_font("Itim"),
  text_font_google   = google_font("Roboto Slab", "300", "300i"),
  # code_font_google   = google_font("Fira Mono")
  code_font_google   = google_font("Source Code Pro")
)
```


# Sobre el curso...

- Enfoque pr√°ctico.

# Objetivos:

1. Conocer la filosof√≠a **grammar of graphics**
1. Manejar `R` utilizando el IDE `RStudio` 
1. Utilizar paquetes para visualizaci√≥n de datos 
  1. `ggplot2`
  1. `patchwork`
  1. `plotly`
  1. `gganimate`

---

# Grammar of graphics

- Aproximaci√≥n te√≥rica sobre como construir gr√°ficos [1]
- Muchos programas: ggplot, tableau, vega-lite
- No se centra en
  - el tipo de gr√°fico que es mejor en funci√≥n del tipo de datos
  - el aspecto visual del gr√°fico
  - el algoritmo necesario para definir el gr√°fico
- S√≠ se centra en el mecanismo. ¬øC√≥mo dise√±ar el sistema que nos permite construir el gr√°fico?

.footnote[[1] [https://www.springer.com/gp/book/9780387245447](https://www.springer.com/gp/book/9780387245447)]

---

# Grammar of graphics

![Grammar of graphics](./imgs/capas.png)

---

# Herramientas: `ggplot2`

- Grammar of graphics es un sistema de dise√±o, `ggplot2` es una implementaci√≥n.
- Teor√≠a y pr√°ctica son diferentes - algunas de las capas pueden mapearse juntas.

### Instalaci√≥n y carga del paquete en R

```{r eval=FALSE}
install.packages("ggplot2")
library(ggplot2)
```

---

# ¬øQu√© datos vamos a visualizar?

Ejemplos de gr√°ficos seg√∫n el tipo de variables

- Num√©ricos
  - Una variable: histogr√°ma 
  - Dos variables: gr√°ficos de dispersi√≥n
- Categ√≥ricos
  - Una variable: Gr√°fico de barras
  - Dos varaibles: Gr√°fico de barras coloreado
- Num√©ricos y categ√≥ricos
  - Gr√°fico de dispersi√≥n coloreado
  - Gr√°fico de cajas separado por categor√≠as
  ...

.footnote[Para una clasificaci√≥n detallada puedes consultar: https://www.data-to-viz.com]

---

# Tipos de datos en `R`

- Variables continuas:
  - N√∫meros enteros `int`
  - N√∫meros decimales `dbl`
  - En general, `num`
- Variables discretas: 
  - Factores `fct`
  - Factores ordenados `ord`

Otros tipos:

- `NA` (not available). El dato no est√° disponible.
- `NaN` (not a number). Se esperaba un dato num√©rico pero el que hay no lo es.
- `NULL` - nada. 

---

#  Datos: `penguins` üêß 

```{r eval=FALSE}
install.packages("palmerpenguins")
palmerpenguins::penguins
```

Datos de 344 ping√ºinos de  3 especies diferentes, recogidos de 3 islas del Archipelago Palmer, Ant√°rctica.

- `species           ` : Adelie, Chinstra, Gentoo. Tipo `fct` 
- `island            ` : Biscoe, Dream, Torgersen. Tipo `fct` 
- `bill_length_mm    ` : Longitud del pico. Tipo `dbl` 
- `bill_depth_mm     ` : Profundidad del pico. Tipo `dbl` 
- `flipper_length_mm ` : Longitud de la aleta. Tipo `int` 
- `body_mass_g       ` : Peso. Tipo `int` 
- `sex               ` : Sexo. Tipo `fct` 
- `year              ` : A√±o (2007, 2008, 2009). Tipo `int` 


---

# Ping√ºinos üêß

```{r echo=FALSE, tidy=FALSE}
rmarkdown::paged_table(penguins)
```


---

# Visualizaciones para una sola variable categ√≥rica

- Gr√°fico de barras para contar el n√∫mero de ping√ºinos estudiados en cada isla

.pull-left[
```{r echo=FALSE, fig.height=4}
ggplot(data = penguins, aes(x = island)) + stat_count()
```


```{r eval=FALSE, include=TRUE}
ggplot(data = penguins, 
       aes(x = island)) + 
  stat_count()
```
]

--

.pull-right[
```{r echo=FALSE, fig.height=4}
ggplot(data = penguins, 
       aes(x = island)) + 
  geom_bar()
```


```{r eval=FALSE, include=TRUE}
ggplot(data = penguins, 
       aes(x = island)) + 
  geom_bar()
```
]

---

# Visualizaciones para una sola variable num√©rica: Histograma


```{r echo=FALSE, fig.height=4}
ggplot(penguins, aes(bill_length_mm)) +
  geom_histogram()
```

--

```{r eval=FALSE, include=TRUE}
ggplot(data = penguins, aes(x = bill_length_mm)) +
  geom_histogram()
```

---
class: middle, center, inverse

# Ejercicios

---

#  Datos: `diamonds` üíé 

```
ggplot2::diamonds
```

Datos sobre los precios y otros atributos de de 53940 diamantes. 

- `carat   `: peso del diamante `dbl`
- `cut     `: calidad del corte (Fair, Good, Very Good, Premium, Ideal) `ord`
- `color   `: colour, desde D (best) hasta J (worst)`ord`
- `clarity `: medida de c√≥mo de claro es el diamante (I1 (worst), SI2, SI1, VS2, VS1, VVS2, VVS1, IF (best)) `ord`
- `depth   `: porcentaje total de profundidad 2 * z / (x + y) `dbl`
- `table   `: width of top of diamond relative to widest point `dbl`
- `price   `: precio en dolares estadonidenses `int`
- `x       `: longitud en mm `dbl`
- `y       `: ancho en mm `dbl`
- `z       `: profundidad en mm `dbl`

---

#  Diamantes üíé

```{r echo=FALSE, tidy=FALSE}
rmarkdown::paged_table(diamonds)
```

---

# Ejercicios

.pull-left[
```{r echo=FALSE, fig.height=4}
ggplot(data = diamonds, 
       aes(x = cut)) +
  stat_count()
```
]

.pull-right[
```{r echo=FALSE, fig.height=4}
ggplot(data = diamonds, 
       aes(x = clarity)) + 
  stat_count()
```
]

---

# Soluciones

.pull-left[
```{r echo=FALSE, fig.height=4}
ggplot(data = diamonds, aes(x = cut)) +
  stat_count()
```

```
ggplot(data = diamonds, 
        aes(x = cut)) +
  stat_count() 
```

]

.pull-right[
```{r echo=FALSE, fig.height=4}
ggplot(data = diamonds, aes(x = clarity)) +
  stat_count()
```

```
ggplot(data = diamonds, 
        aes(x = clarity)) +
  stat_count()
```
]


---
class: center, middle

# Visualizaciones para dos variables num√©ricas

## Gr√°ficos de dispersi√≥n
 
y adem√°s modificaciones de la est√©tica

---

#  Datos: `penguins` üêß 

![Relaci√≥n entre bill_length_mm y bill_depth_mm](./imgs/pico.png)


---

# Gr√°fico de dispersi√≥n

```{r echo=FALSE, fig.height=4}
ggplot(data = penguins, aes(x = bill_length_mm, y = bill_depth_mm)) +
  geom_point()
```

--

```{r eval=FALSE, include=TRUE}
ggplot(data = penguins, aes(x = bill_length_mm, y = bill_depth_mm)) +
  geom_point()
```

--

O tambi√©n:

```{r eval=FALSE, include=TRUE}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm)) + #<<
  geom_point()
```

---

## Color üé®

```{r echo=FALSE, fig.height=4}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm)) +
  geom_point(color = "blue")
```

--

```{r eval=FALSE, include=TRUE}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm)) +
  geom_point(color = "blue") #<<
```

--

Colores por defecto disponibles: http://sape.inf.usi.ch/quick-reference/ggplot2/colour 

---

## Color personalizado üßë‚Äçüé®

```{r echo=FALSE, fig.height=4}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm)) +
  geom_point(color = "#fabada")
```

--

```{r eval=FALSE, include=TRUE}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm)) +
  geom_point(color = "#fabada") #<<
```

Para encontrar m√°s colores: [https://coolors.com](https://coolors.com)

---

## Solapando `geom`s

```{r echo=FALSE, fig.height=4}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm)) +
  geom_point(color = "#fabada") +
  geom_hline(yintercept = 15.2) 
```

--

```{r eval=FALSE, include=TRUE}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm)) +
  geom_point(color = "#fabada") +
  geom_hline(yintercept = 15.2) #<<
```

---

## Solapando `geom`s

```{r echo=FALSE, fig.height=4}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm)) +
  geom_point(color = "#fabada") +
  geom_hline(yintercept = 15.2) +
  geom_vline(xintercept = 43) 
```

--

```{r eval=FALSE, include=TRUE}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm)) +
  geom_point(color = "#fabada") +
  geom_hline(yintercept = 15.2) +
  geom_vline(xintercept = 43) #<<
```

---

## Solapando `geom`s

```{r echo=FALSE, fig.height=4}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm)) +
  geom_point(color = "#fabada") +
  geom_hline(yintercept = 15.2, color = "red", linetype = "dotted") +  
  geom_vline(xintercept = 43, color = "grey", linetype = "dashed")  
```

--

```{r eval=FALSE, include=TRUE}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm)) +
  geom_point(color = "#fabada") +
  geom_hline(yintercept = 15.2, color = "red", linetype = "dotted") +  #<<
  geom_vline(xintercept = 43, color = "grey", linetype = "dashed")  #<<
```

Puedes encontrar un resumen de todos los tipos de l√≠nea [aqu√≠](http://www.sthda.com/english/wiki/ggplot2-line-types-how-to-change-line-types-of-a-graph-in-r-software).

---

## Rectas gen√©ricas

```{r echo=FALSE, fig.height=4}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm)) +
  geom_point(color = "#fabada") +
  geom_abline(slope = .3, intercept = 2)
```

--

```{r eval=FALSE, include=TRUE}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm)) +
  geom_point(color = "#fabada") +
  geom_abline(slope = .3, intercept = 2) #<<
```

---

## Cuidado con el tama√±o ‚òùüèª

```{r echo=FALSE, fig.height=4}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm)) +
  geom_point(color = "#fabada") +
  geom_abline(slope = .3, intercept = 2, size = 2) 
```

--

```{r eval=FALSE, include=TRUE}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm)) +
  geom_point(color = "#fabada") +
  geom_abline(slope = .3, intercept = 2, size = 2) #<<
```

---

## El orden de las capas tambi√©n importa

```{r echo=FALSE, fig.height=4}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm)) +
  geom_abline(slope = .3, intercept = 2, size = 2) + #<<
  geom_point(color = "#fabada") #<<
```

--

```{r eval=FALSE, include=TRUE}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm)) +
  geom_abline(slope = .3, intercept = 2, size = 2) + #<<
  geom_point(color = "#fabada") #<<
```

---

## Mapeando variables como `color`

```{r echo=FALSE, fig.height=4}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm, color = sex)) + #<<
  geom_point()
```

--

```{r eval=FALSE, include=TRUE}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm, color = sex)) + #<<
  geom_point()
```

---

## Aesthetic vs. apariencia ‚ö†Ô∏è


```{r fig.height=2}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm)) +
  geom_point(color = "blue") #<<
```


```{r fig.height=2}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm, color = sex)) + #<<
  geom_point()
```

---

## Personalizando la escala de colores üñºÔ∏è

```{r fig.height=4}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm, color = sex)) +
  geom_point() +
  scale_color_manual(values = c("green", "orange")) #<<
```

[Aqu√≠](http://www.sthda.com/english/wiki/ggplot2-colors-how-to-change-colors-automatically-and-manually) puedes encontrar m√°s ejemplos, as√≠ como paletas de colores ya predefinidas en R.

---

# Paletas predeterminadas üé®

```{r, echo=FALSE, fig.height=4}
knitr::include_graphics("./imgs/paletas.png")
```

---

# Paletas predeterminadas üé®

```{r echo=FALSE, fig.height=4}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm, color = sex)) +
  geom_point() + 
  scale_color_brewer(palette="Dark2")
```

--

```{r eval=FALSE, include=TRUE}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm, color = sex)) +
  geom_point() + 
  scale_color_brewer(palette="Dark2") #<<
```

---

# Tambi√©n hay otros paquetes üßë‚Äçüé®

```{r}
# install.packages("wesanderson")
library(wesanderson)
```

```{r}
names(wes_palettes)
```

---

# Tambi√©n hay otros paquetes üßë‚Äçüé®

```{r echo=FALSE, fig.height=4}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm, color = sex)) +
  geom_point() + 
  scale_color_manual(values=wes_palette(n=3, name="GrandBudapest1")) 
```

--

```{r eval=FALSE, include=TRUE}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm, color = sex)) +
  geom_point() + 
  scale_color_manual(values=wes_palette(n=3, name="GrandBudapest1")) #<<
```

---

## Utilizando condiciones para colorear

```{r echo=FALSE, fig.height=5}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm, 
                     color = body_mass_g > 4000)) + 
  geom_point()
```

--

```{r eval=FALSE, include=TRUE}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm, 
                     color = body_mass_g > 4000)) + #<<
  geom_point()
```

---

## M√°s aesthetics: `shape`

```{r echo=FALSE, fig.height=4}
ggpubr::show_point_shapes()
```

Por defecto, la shape utilizada es la n√∫mero 16.

- Algunas tienen solo `color`, que rellena el interior de la forma.
- Otras tienen `color` para el borde y `fill` para su interior.

---

## M√°s aesthetics: `shape`

```{r echo=FALSE, fig.height=4}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm)) +
  geom_point(shape = 17) 
```

--

```{r eval=FALSE, include=TRUE}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm)) +
  geom_point(shape = 17) #<<
```

---

## De nuevo, aesthetic vs. apariencia ‚ö†Ô∏è

```{r echo=FALSE, fig.height=4}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm, 
                     shape = island)) + #<<
  geom_point()
```

--

```{r eval=FALSE, include=TRUE}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm, 
                     shape = island)) + #<<
  geom_point()
```

---

## Tambi√©n podemos combinarlas

```{r echo=FALSE, fig.height=4}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm, 
                     shape = island, color = sex)) + #<<
  geom_point()
```

--

```{r eval=FALSE, include=TRUE}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm, 
                     shape = island, color = sex)) + #<<
  geom_point()
```

---

## Diferencia entre color y fill

Vamos a elegir una de las formas con contorno:

```{r fig.height=4}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm)) +
  geom_point(shape = 23)
```

---

## Diferencia entre color y fill

.pull-left[
```{r echo=FALSE, fig.height=4}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm, 
                     color = sex)) + #<<
  geom_point(shape = 23)
```

--

```{r eval=FALSE, include=TRUE}
ggplot(penguins, 
       aes(bill_length_mm, 
           bill_depth_mm, 
           color = sex)) + #<<
  geom_point(shape = 23)
```


]

.pull-right[
```{r echo=FALSE, fig.height=4}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm, 
                     fill = sex)) + #<<
  geom_point(shape = 23)
```

--

```{r eval=FALSE, include=TRUE}
ggplot(penguins, 
       aes(bill_length_mm, 
           bill_depth_mm, 
           fill = sex)) + #<<
  geom_point(shape = 23)
```
]

---

## Diferencia entre color y fill

```{r fig.height=4}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm, 
                     color = island, fill = sex)) + #<<
  geom_point(shape = 23)
```

Poder, se puede pero... ü•¥

---

## Otra aesthetic: `size`

```{r echo=FALSE, fig.height=4}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm, size = island)) +
  geom_point(color = "blue")
```

--

```{r eval=FALSE, include=TRUE}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm, 
                     size = island)) + #<<
  geom_point(color = "blue")
```

---

# El valor de `alpha`

Habitualmente cuando trabajamos con `size` los puntos se solapan

```{r echo=FALSE, fig.height=4}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm, size = island)) +
  geom_point(color = "blue", alpha = .4)
```

--

```{r eval=FALSE, include=TRUE}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm, size = island)) +
  geom_point(color = "blue", alpha = .4) #<<
```

---

# La aesthetic `alpha`

```{r echo=FALSE, fig.height=4}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm, 
                     size = island,
                     alpha = island)) + #<<
  geom_point(color = "blue")
```

--

```{r echo=TRUE, include=FALSE}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm, 
                     size = island,
                     alpha = island)) + #<<
  geom_point(color = "blue")
```

Observa c√≥mo se unifican las leyendas al mapear la misma variable en dos aesthetics.

---

# Resumen

.pull-left[
## `geom_`

- `geom_bar()`
- `geom_point()`
- `geom_hline()`
- `geom_vline()`
- `geom_abline()`
]

.pull-right[
## aesthetics

Pueden ser mapeadas en `aes()` en funci√≥n de una variable o en general para una `geom`.

- `color`
- `fill`
- `alpha`
- `size`
]

---

# Almacenando un objeto

```{r fig.height=4}
p <- ggplot(penguins, aes(bill_length_mm, bill_depth_mm)) +
  geom_point(color = "blue")
p
```

Ahora el objeto `p` est√° disponible para hacer cualquier tipo de modificaci√≥n.

---

```{r}
p + labs(title="Relaci√≥n bill_depth/bill_length en mm")
```

---

# Temas

El paquete tiene temas predefinidos que permiten modificaciones r√°pidas del aspecto visual.

- `theme_grey`
- `theme_bw`
- `theme_linedraw`
- `theme_light`
- `theme_dark`
- `theme_minimal`
- `theme_classic`
- `theme_void`

---

.pull-left[

```{r fig.height=4}
p + theme_grey()
```

```{r fig.height=4}
p + theme_linedraw()
```


]

.pull-right[

```{r fig.height=4}
p + theme_bw()
```

```{r fig.height=4}
p + theme_light()
```

]

---


.pull-left[

```{r fig.height=4}
p + theme_dark()
```

```{r fig.height=4}
p + theme_classic()
```


]

.pull-right[

```{r fig.height=4}
p + theme_minimal()
```

```{r fig.height=4}
p + theme_void()
```

]

Puedes encontrar m√°s informaci√≥n sobre los temas [aqu√≠](https://ggplot2.tidyverse.org/reference/ggtheme.html).

---

# Otros paquetes que traen temas predeterminados

```{r eval=FALSE}
library(hrbrthemes)
```

---

# Modificar algunos aspectos del tema

```
ggplot(penguins, aes(bill_length_mm, fill = sex)) +
  geom_histogram(alpha = .6, color = "black") +
  theme_ipsum()
```

--- 

# Valores continuos en `size`

```{r fig.height=5}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm, size = year)) +
  geom_point(color = "blue")
```

---

# Forzar una variable a ser discreta

Ahora queremos dar tama√±o a los puntos en funci√≥n del a√±o en el que fueron recogidos los datos.

Si recordamos la tabla de ping√ºinos, la variable a√±o es num√©rica.

Pero sabesmo que solo hay tres a√±os. Para forzar a que esta variable sea categ√≥rica podemos utilizar `as.factor()`

---

## Forzar una variable a ser discreta

```{r echo=FALSE, fig.height=5}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm, size = as.factor(year))) +
  geom_point(color = "blue")
```

--

```{r eval=FALSE, include=TRUE}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm, size = as.factor(year))) +
  geom_point(color = "blue")
```

---

## Modificar el t√≠tulo de la leyenda

Ahora el t√≠tulo de la leyenda muestra el c√≥digo que hemos utilizado. ¬øC√≥mo podemos cambiarlo?

.pull-left[
```{r echo=FALSE, fig.height=5}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm, size = as.factor(year))) +
  geom_point(color = "blue")
```
]

.pull-right[
```{recho=FALSE, fig.height=5}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm, size = as.factor(year))) +
  geom_point(color = "blue") +
  labs(size = "A√±o")
```
]

---

## Variable discreta en el eje x

Hasta ahora hemos trabajado con variables continuas en ambos ejes. ¬øQu√© pasa si utilizamos una variable discreta con `geom_point()`? Utilizando body_mass_g para obtener lo siguiente

```{r echo=FALSE, fig.height=4}
ggplot(penguins, aes(species, body_mass_g)) +
  geom_point()
```

--

```{r eval=FALSE, include=TRUE}
ggplot(penguins, aes(species, body_mass_g)) + #<<
  geom_point()
```

---

## Colorear utilizando una variable continua

Hasta ahora hemos trabajado con variables discretas para el color. ¬øQu√© pasa si utilizamos una variable continua? 

```{r fig.height=4}
ggplot(penguins, aes(species, body_mass_g, color = body_mass_g)) +
  geom_point()
```

---

## ¬øQu√© ocurre con `shape`?

Para shape tambi√©n hemos utilizado solo variables discretas, ¬øqu√© pasa si intentamos poner una continua?

---

# Color con variable discreta

Ya conocemos esta forma de colorear utilizando una variable discreta:

```{r fig.height=4}
ggplot(penguins, aes(species, body_mass_g, color = species)) +
  geom_point()
```

--

En esta representaci√≥n los puntos quedan muy solapados, podemos a√±adir algo de aleatoreidad en el eje $x$ para cambiar la representaci√≥n.

---

# A√±adiendo jitter

```{r fig.height=4}
ggplot(penguins, aes(species, body_mass_g, color = species)) +
  geom_jitter(height = 0)
```

---

# Estad√≠stica

```{r fig.height=4}
ggplot(penguins, aes(species, body_mass_g, color = species)) +
  geom_jitter() +
  stat_summary(fun = mean)
```

---

# Aesthetics exclusivas de cada geom

```{r fig.height=4}
ggplot(penguins, aes(species, body_mass_g)) +
  geom_point(aes(color = species)) +
  stat_summary(fun = mean)
```

---

# Aesthetics exclusivas de cada geom

```{r fig.height=4}
ggplot(penguins, aes(species, body_mass_g)) +
  stat_summary(fun = mean, size = 2) +
  geom_point(aes(color = species)) 
```

---

# Comparaci√≥n 

Ambas representaciones producen la misma salida:

```
ggplot(penguins, aes(species, body_mass_g, color = species)) +
  geom_point() 
```

```
ggplot(penguins, aes(species, body_mass_g)) +
  geom_point(aes(color = species)) 
```

Esta produce una salida diferente

```
ggplot(penguins, aes(species, body_mass_g)) +
  geom_point(color = "blue") 
```

---

# Modificando las etiquetas

Otra alternativa:

```{r fig.height=4}
ggplot(penguins, aes(island, species, color = species)) +
  geom_jitter() +
  xlab("Especie") +
  ylab("Isla") 
```


---

## Dos variables discretas

¬øQu√© pasa si queremos hacer un diagrama similar con dos variables discretas?

--

```{r fig.height=4}
ggplot(penguins, aes(island, species, color = species)) +
  geom_point()
```

---

## Utilizando jitter

```{r fig.height=4}
ggplot(penguins, aes(island, species, color = species)) +
  geom_jitter()
```

En este caso podemos permitir aleatoriedad en ambos ejes

---

# Modificando las etiquetas

```{r fig.height=4}
ggplot(penguins, aes(island, species, color = species)) +
  geom_jitter() +
  xlab("Especie") +
  ylab("Isla") 
```

---
class: center

# Diagramas de barras

---

# Ya sabemos hacer un gr√°fico de barras de una sola variable

```{r fig.height=4}
ggplot(penguins, aes(species)) +
  geom_bar()
```

---

# Diagrama de barras

Colorear utilizando el sexo de los ping√ºinos

```{r echo=FALSE, fig.height=4}
ggplot(penguins, aes(species, fill = sex)) +
  geom_bar()
```

--

```{r include=TRUE, eval=FALSE}
ggplot(penguins, aes(species, fill = sex)) +
  geom_bar()
```

--

Est√° representaci√≥n no es muy √∫til para comparar

--

# Diagrama de barras


Un error com√∫n al utilizar `stat_count()` es el siguiente:


```
stat_count() can only have an x or y aesthetic.
```

---

# Posiciones: `stack`

La posici√≥n por defecto es `stack`, que muestra lo mismo que el c√≥digo anterior

```{r fig.height=4}
ggplot(penguins, aes(species, fill = sex)) +
  geom_bar(position = "stack")
```

---

# Posiciones: `dodge`

```{r fig.height=4}
ggplot(penguins, aes(species, fill = sex)) +
  geom_bar(position = "dodge")
```

---

# ¬øEn qu√© isla hay m√°s de la especie Adelie?

.pull-left[
```{r fig.height=4}
ggplot(penguins, aes(island, fill = species)) + 
  geom_bar()
```

]

.pull-right[

```{r fig.height=4}
ggplot(penguins, aes(island, fill = species)) + 
  geom_bar(position = "dodge")
```

]

---

# A√±adiendo labels a la posici√≥n `stack`

Otra opci√≥n para comparar es a√±adir etiquetas utilizando `geom_bar()`

```{r fig.height=4}
ggplot(penguins, aes(species, fill = sex)) + 
  geom_bar() +
  geom_text(stat='count', aes(label=..count..), position = position_stack(vjust=.5))
```

El par√°metro `vjust` representa el ajuste vertical:

- 0 para alinear con la parte de abajo
- 0.5 para alinear en el medio 
- 1 (default) para alinear con la parte de arriba

---

# A√±adiendo labels a la posici√≥n `dodge`

```{r fig.height=4}
ggplot(penguins, aes(species, fill = sex)) + 
  geom_bar(position = "dodge") +
  geom_text(stat='count', aes(label=..count..), vjust=-1, position = position_dodge(width = 1))
```


---

# Datos resumidos

```
penguins_total <- penguins %>% group_by(species, sex) %>% count()
ggplot(penguins_total, aes(x = species, y = sex)) +
  geom_bar()
```

```{r fig.height=4}
penguins_total <- penguins %>% 
  group_by(species, sex) %>% 
  count()
penguins_total
```


---

# Datos resumidos: stat `identity`

Ya no podemos utilizar la stat `count`

```{r fig.height=4}
ggplot(penguins_total, aes(x = species, y = n, fill = sex)) +
  geom_bar(stat = "identity")
```

---

# Datos resumidos: position `dodge`

```{r fig.height=4}
ggplot(penguins_total, aes(x = species, y = n, fill = sex)) +
  geom_bar(stat = "identity", position = "dodge")
```

---
class: center, middle, inverse

# Esquisser

---

# Esquisser

- Herramienta para crear gr√°ficos `ggplot2`.
- Interfaz *drag-and-drop* que permite mapear variables en diferentes aesthetics. 
- Visualizaci√≥n del gr√°fico
- Generaci√≥n din√°mica del c√≥digo

```
install.packages("esquisse")
esquisse::esquisser()
```

.footnote[
Referencia del paquete en CRAN: https://cran.r-project.org/web/packages/esquisse/index.html

Blog: https://www.business-science.io/code-tools/2021/03/23/ggplot-code-with-tableau-esquisse.html?utm_content=bufferf9d3e&utm_medium=social&utm_source=linkedin.com&utm_campaign=buffer
]

---

# Esquisser

**Ventajas:**

- Interfaz amigable que evita escribir el c√≥digo *from scratch*

**Inconvenientes:**

- Tiene opciones limitadas
- Es un software muy joven ü™≤üêõ

---

# La importancia del c√≥digo

¬øQu√© pasa si queremos hacer este tipo de gr√°ficos?

.pull-left[

**Ejercicio 1**

```{r echo=FALSE, fig.height=4}
ggplot(penguins %>% filter(!is.na(sex)), aes(island, fill = species)) +
  geom_bar(position = "fill", alpha = .3, color = "black") +
  geom_text(aes(label = ..count..), stat="count", position = position_fill(vjust=.5), fontface = "bold") +
  scale_y_continuous(labels = scales::percent) +
  xlab("Isla") +
  ylab("") +
  coord_flip() +
  theme_light() +
  guides(fill=guide_legend(title="Especie")) +
  theme(panel.grid.minor.x = element_blank(),
        panel.grid.major.y = element_blank())
```
]

.pull-right[

**Ejercicio 2**

```{r echo=FALSE, fig.height=4}
ggplot(penguins, aes(bill_length_mm)) +
  geom_histogram(data = penguins %>% filter(sex == "female"), aes(y = ..count.., fill = sex), alpha = .6, color = "black") +
  geom_histogram(data = penguins %>% filter(sex == "male"), aes(y = -..count.., fill = sex), alpha = .6, color = "black") +
  geom_vline(xintercept = penguins %>% pull(bill_length_mm) %>% mean(na.rm = TRUE)) +
  geom_vline(xintercept = penguins %>% filter(sex == "female") %>% pull(bill_length_mm) %>% mean(na.rm = TRUE), color = "green", linetype = "dashed", size = 1.5) +
  geom_vline(xintercept = penguins %>% filter(sex == "male") %>% pull(bill_length_mm) %>% mean(na.rm = TRUE), color = "purple", linetype = "dashed", size = 1.5) +
  geom_label(aes(x=58, y=10, label="hembra"), color = "green", family = "Times", fontface = "bold" ) +
  geom_label(aes(x=58, y=-10, label="macho"), color = "purple", family = "Times", fontface = "bold") + 
  scale_fill_manual(values = c("green", "purple")) +
  labs(title="Histograma de ping√ºinos \ndividido por sexo",
       x ="Longitud del pico", y = "N√∫mero de ping√ºinos") +
  scale_x_continuous(n.breaks = 6) +
  scale_y_continuous(labels=abs) +
  theme_minimal() +
  theme(legend.position = "none", 
        text=element_text(size=16,  family="Times"),
        axis.title.x = element_text(margin=margin(15,0,0,0)),
        axis.title.y = element_text(margin=margin(0,15,0,0)))
```
]

---

