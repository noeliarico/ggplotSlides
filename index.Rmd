---
title: "Visualizaci√≥n de datos para la transferencia \\ de resultados en distintos √°mbitos cient√≠ficos"
subtitle: "INIE - Formaci√≥n PDI, UniOvi"  
author: "Noelia Rico - Departamento de Inform√°tica"
date: '5-6 JULIO 2021'
output:
  xaringan::moon_reader:
    lib_dir: libs
    css: xaringan-themer.css
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{r setup, include=FALSE}
library(tidyverse)
library(palmerpenguins)
library(babynames)
library(gapminder)
library(gganimate)
library(plotly)
library(gifski)
options(htmltools.dir.version = FALSE)
options(htmltools.preserve.raw = FALSE)
knitr::opts_chunk$set(fig.retina = 3, fig.align = 'center', warning = FALSE, message = FALSE)
```

```{r xaringan-themer, include=FALSE, warning=FALSE}
# Colores uniovi
verde <- "#018082"
amarillo_oscuro <- "#EAAE30"
amarillo_claro <- "#F4D598"
azul <- "#53A0D5"

library(xaringanthemer)
style_mono_accent(
  # Colors ---
  base_color = verde,
 # link_color = azul,
  code_inline_background_color = "#F8F8F8",
  inverse_background_color = amarillo_claro,
  base_font_size = "18px",
  # Fonts ---
  # header_font_google = google_font("Josefin Sans"),
  header_font_google = google_font("Rubik"),
  text_font_google   = google_font("Roboto Slab", "300", "300i"),
  code_font_google   = google_font("Fira Mono")
  #code_font_google   = google_font("Source Code Pro")
)
```


# Sobre el curso...

- Enfoque pr√°ctico.

# Objetivos:

1. Conocer la filosof√≠a **grammar of graphics**
1. Manejar `R` utilizando el IDE `RStudio` 
1. Utilizar paquetes para visualizaci√≥n de datos 
  1. `ggplot2`
  1. `patchwork`
  1. `plotly`
  1. `gganimate`
  1. `wordcloud`
  1. `waffle`

---

# Grammar of graphics

- Aproximaci√≥n te√≥rica sobre como construir gr√°ficos.
- Muchos programas: ggplot, tableau, vega-lite
- No se centra en
  - el tipo de gr√°fico que es mejor en funci√≥n del tipo de datos
  - el aspecto visual del gr√°fico
  - el algoritmo necesario para definir el gr√°fico
- S√≠ se centra en el mecanismo. ¬øC√≥mo dise√±ar el sistema que nos permite construir el gr√°fico?

.footnote[Grammar of graphics: [https://www.springer.com/gp/book/9780387245447](https://www.springer.com/gp/book/9780387245447)]

---

# Grammar of graphics

![Grammar of graphics](./imgs/capas.png)

---

# Herramientas: `ggplot2`

- Grammar of graphics es un sistema de dise√±o, `ggplot2` es una implementaci√≥n.
- Teor√≠a y pr√°ctica son diferentes - algunas de las capas pueden mapearse juntas.

### Instalaci√≥n y carga del paquete en R

```{r eval=FALSE}
install.packages("ggplot2")
library(ggplot2)
```

---

# ¬øQu√© datos vamos a visualizar?

Ejemplos de gr√°ficos seg√∫n el tipo de variables

- Num√©ricos
  - Una variable: histogr√°ma 
  - Dos variables: gr√°ficos de dispersi√≥n
- Categ√≥ricos
  - Una variable: Gr√°fico de barras
  - Dos varaibles: Gr√°fico de barras coloreado
- Num√©ricos y categ√≥ricos
  - Gr√°fico de dispersi√≥n coloreado
  - Gr√°fico de cajas separado por categor√≠as
  ...

.footnote[Para una clasificaci√≥n detallada puedes consultar: https://www.data-to-viz.com]

---

# Tipos de datos en `R`

- Variables continuas:
  - N√∫meros enteros `int`
  - N√∫meros decimales `dbl`
  - En general, `num`
- Variables discretas: 
  - Factores `fct`
  - Factores ordenados `ord`

Otros tipos:

- `NA` (not available). El dato no est√° disponible.
- `NaN` (not a number). Se esperaba un dato num√©rico pero el que hay no lo es.
- `NULL` - nada. 

---

#  Datos: `penguins` üêß 

```{r eval=FALSE}
install.packages("palmerpenguins")
palmerpenguins::penguins
```

Datos de 344 ping√ºinos de  3 especies diferentes, recogidos de 3 islas del Archipelago Palmer, Ant√°rctica.

- `species           ` : Adelie, Chinstra, Gentoo. Tipo `fct` 
- `island            ` : Biscoe, Dream, Torgersen. Tipo `fct` 
- `bill_length_mm    ` : Longitud del pico. Tipo `dbl` 
- `bill_depth_mm     ` : Profundidad del pico. Tipo `dbl` 
- `flipper_length_mm ` : Longitud de la aleta. Tipo `int` 
- `body_mass_g       ` : Peso. Tipo `int` 
- `sex               ` : Sexo. Tipo `fct` 
- `year              ` : A√±o (2007, 2008, 2009). Tipo `int` 


---

# Ping√ºinos üêß

```{r echo=FALSE, tidy=FALSE}
rmarkdown::paged_table(penguins)
```


---

# Visualizaciones para una sola variable categ√≥rica

- Gr√°fico de barras para contar el n√∫mero de ping√ºinos estudiados en cada isla

.pull-left[
```{r echo=FALSE, fig.height=3}
ggplot(data = penguins, aes(x = island)) + stat_count()
```


```{r eval=FALSE, include=TRUE}
ggplot(data = penguins, 
       aes(x = island)) + 
  stat_count()
```
]

--

.pull-right[
```{r echo=FALSE, fig.height=3}
ggplot(data = penguins, 
       aes(x = island)) + 
  geom_bar()
```


```{r eval=FALSE, include=TRUE}
ggplot(data = penguins, 
       aes(x = island)) + 
  geom_bar()
```
]

---

# Visualizaciones para una sola variable num√©rica: Histograma


```{r echo=FALSE, fig.height=3}
ggplot(penguins, aes(bill_length_mm)) +
  geom_histogram()
```

--

```{r eval=FALSE, include=TRUE}
ggplot(data = penguins, aes(x = bill_length_mm)) +
  geom_histogram()
```

---
class: middle, center, inverse

# Ejercicios

---

#  Datos: `diamonds` üíé 

```
ggplot2::diamonds
```

Datos sobre los precios y otros atributos de de 53940 diamantes. 

- `carat   `: peso del diamante `dbl`
- `cut     `: calidad del corte (Fair, Good, Very Good, Premium, Ideal) `ord`
- `color   `: colour, desde D (best) hasta J (worst)`ord`
- `clarity `: medida de c√≥mo de claro es el diamante (I1 (worst), SI2, SI1, VS2, VS1, VVS2, VVS1, IF (best)) `ord`
- `depth   `: porcentaje total de profundidad 2 * z / (x + y) `dbl`
- `table   `: width of top of diamond relative to widest point `dbl`
- `price   `: precio en dolares estadonidenses `int`
- `x       `: longitud en mm `dbl`
- `y       `: ancho en mm `dbl`
- `z       `: profundidad en mm `dbl`

---

#  Diamantes üíé

```{r echo=FALSE, tidy=FALSE}
rmarkdown::paged_table(diamonds)
```

---

# Ejercicios

.pull-left[
```{r echo=FALSE, fig.height=3}
ggplot(data = diamonds, 
       aes(x = cut)) +
  stat_count()
```
]

.pull-right[
```{r echo=FALSE, fig.height=3}
ggplot(data = diamonds, 
       aes(x = clarity)) + 
  stat_count()
```
]

---

# Soluciones

.pull-left[
```{r echo=FALSE, fig.height=3}
ggplot(data = diamonds, aes(x = cut)) +
  stat_count()
```


```
ggplot(data = diamonds, 
        aes(x = cut)) +
  stat_count() 
```


]

.pull-right[
```{r echo=FALSE, fig.height=3}
ggplot(data = diamonds, aes(x = clarity)) +
  stat_count()
```


```
ggplot(data = diamonds, 
        aes(x = clarity)) +
  stat_count()
```

]


---
class: center, middle

# Visualizaciones para dos variables num√©ricas

## Gr√°ficos de dispersi√≥n
 
y adem√°s modificaciones de la est√©tica

---

#  Datos: `penguins` üêß 

![Relaci√≥n entre bill_length_mm y bill_depth_mm](./imgs/pico.png)


---

# Gr√°fico de dispersi√≥n

```{r echo=FALSE, fig.height=3}
ggplot(data = penguins, aes(x = bill_length_mm, y = bill_depth_mm)) +
  geom_point()
```

--

```{r eval=FALSE, include=TRUE}
ggplot(data = penguins, aes(x = bill_length_mm, y = bill_depth_mm)) +
  geom_point()
```

--

O tambi√©n:

```{r eval=FALSE, include=TRUE}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm)) + #<<
  geom_point()
```

---

## Color üé®

```{r echo=FALSE, fig.height=3}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm)) +
  geom_point(color = "blue")
```

--

```{r eval=FALSE, include=TRUE}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm)) +
  geom_point(color = "blue") #<<
```

--

Colores por defecto disponibles: http://sape.inf.usi.ch/quick-reference/ggplot2/colour 

---

## Color personalizado üßë‚Äçüé®

```{r echo=FALSE, fig.height=3}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm)) +
  geom_point(color = "#fabada")
```

--

```{r eval=FALSE, include=TRUE}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm)) +
  geom_point(color = "#fabada") #<<
```

Para encontrar m√°s colores: [https://coolors.com](https://coolors.com)

---

## Solapando `geom`s

```{r echo=FALSE, fig.height=3}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm)) +
  geom_point(color = "#fabada") +
  geom_hline(yintercept = 15.2) 
```

--

```{r eval=FALSE, include=TRUE}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm)) +
  geom_point(color = "#fabada") +
  geom_hline(yintercept = 15.2) #<<
```

---

## Solapando `geom`s

```{r echo=FALSE, fig.height=3}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm)) +
  geom_point(color = "#fabada") +
  geom_hline(yintercept = 15.2) +
  geom_vline(xintercept = 43) 
```

--

```{r eval=FALSE, include=TRUE}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm)) +
  geom_point(color = "#fabada") +
  geom_hline(yintercept = 15.2) +
  geom_vline(xintercept = 43) #<<
```

---

## Solapando `geom`s

```{r echo=FALSE, fig.height=3}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm)) +
  geom_point(color = "#fabada") +
  geom_hline(yintercept = 15.2, color = "red", linetype = "dotted") +  
  geom_vline(xintercept = 43, color = "grey", linetype = "dashed")  
```

--

```{r eval=FALSE, include=TRUE}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm)) +
  geom_point(color = "#fabada") +
  geom_hline(yintercept = 15.2, color = "red", linetype = "dotted") +  #<<
  geom_vline(xintercept = 43, color = "grey", linetype = "dashed")  #<<
```

Puedes encontrar un resumen de todos los tipos de l√≠nea [aqu√≠](http://www.sthda.com/english/wiki/ggplot2-line-types-how-to-change-line-types-of-a-graph-in-r-software).

---

## Rectas gen√©ricas

```{r echo=FALSE, fig.height=3}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm)) +
  geom_point(color = "#fabada") +
  geom_abline(slope = .3, intercept = 2)
```

--

```{r eval=FALSE, include=TRUE}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm)) +
  geom_point(color = "#fabada") +
  geom_abline(slope = .3, intercept = 2) #<<
```

---

## Cuidado con el tama√±o ‚òùüèª

```{r echo=FALSE, fig.height=3}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm)) +
  geom_point(color = "#fabada") +
  geom_abline(slope = .3, intercept = 2, size = 2) 
```

--

```{r eval=FALSE, include=TRUE}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm)) +
  geom_point(color = "#fabada") +
  geom_abline(slope = .3, intercept = 2, size = 2) #<<
```

---

## El orden de las capas tambi√©n importa

```{r echo=FALSE, fig.height=3}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm)) +
  geom_abline(slope = .3, intercept = 2, size = 2) + #<<
  geom_point(color = "#fabada") #<<
```

--

```{r eval=FALSE, include=TRUE}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm)) +
  geom_abline(slope = .3, intercept = 2, size = 2) + #<<
  geom_point(color = "#fabada") #<<
```

---

## Mapeando variables como `color`

```{r echo=FALSE, fig.height=3}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm, color = sex)) + #<<
  geom_point()
```

--

```{r eval=FALSE, include=TRUE}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm, color = sex)) + #<<
  geom_point()
```

---

## Aesthetic vs. apariencia ‚ö†Ô∏è


```{r fig.height=2}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm)) +
  geom_point(color = "blue") #<<
```


```{r fig.height=2}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm, color = sex)) + #<<
  geom_point()
```

---

## Personalizando la escala de colores üñºÔ∏è

```{r fig.height=4}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm, color = sex)) +
  geom_point() +
  scale_color_manual(values = c("green", "orange")) #<<
```

[Aqu√≠](http://www.sthda.com/english/wiki/ggplot2-colors-how-to-change-colors-automatically-and-manually) puedes encontrar m√°s ejemplos, as√≠ como paletas de colores ya predefinidas en R.

---

# Paletas predeterminadas üé®

```{r, echo=FALSE, fig.height=3}
knitr::include_graphics("./imgs/paletas.png")
```

---

# Paletas predeterminadas üé®

```{r echo=FALSE, fig.height=3}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm, color = sex)) +
  geom_point() + 
  scale_color_brewer(palette="Dark2")
```

--

```{r eval=FALSE, include=TRUE}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm, color = sex)) +
  geom_point() + 
  scale_color_brewer(palette="Dark2") #<<
```

---

# Tambi√©n hay otros paquetes üßë‚Äçüé®

```{r}
# install.packages("wesanderson")
library(wesanderson)
```

```{r}
names(wes_palettes)
```

---

# Tambi√©n hay otros paquetes üßë‚Äçüé®

```{r echo=FALSE, fig.height=3}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm, color = sex)) +
  geom_point() + 
  scale_color_manual(values=wes_palette(n=3, name="GrandBudapest1")) 
```

--

```{r eval=FALSE, include=TRUE}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm, color = sex)) +
  geom_point() + 
  scale_color_manual(values=wes_palette(n=3, name="GrandBudapest1")) #<<
```

---

## Utilizando condiciones para colorear

```{r echo=FALSE, fig.height=5}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm, 
                     color = body_mass_g > 4000)) + 
  geom_point()
```

--

```{r eval=FALSE, include=TRUE}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm, 
                     color = body_mass_g > 4000)) + #<<
  geom_point()
```

---

## M√°s aesthetics: `shape`

```{r echo=FALSE, fig.height=3}
ggpubr::show_point_shapes()
```

Por defecto, la shape utilizada es la n√∫mero 16.

- Algunas tienen solo `color`, que rellena el interior de la forma.
- Otras tienen `color` para el borde y `fill` para su interior.

---

## M√°s aesthetics: `shape`

```{r echo=FALSE, fig.height=3}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm)) +
  geom_point(shape = 17) 
```

--

```{r eval=FALSE, include=TRUE}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm)) +
  geom_point(shape = 17) #<<
```

---

## De nuevo, aesthetic vs. apariencia ‚ö†Ô∏è

```{r echo=FALSE, fig.height=3}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm, 
                     shape = island)) + #<<
  geom_point()
```

--

```{r eval=FALSE, include=TRUE}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm, 
                     shape = island)) + #<<
  geom_point()
```

---

## Tambi√©n podemos combinarlas

```{r echo=FALSE, fig.height=3}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm, 
                     shape = island, color = sex)) + #<<
  geom_point()
```

--

```{r eval=FALSE, include=TRUE}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm, 
                     shape = island, color = sex)) + #<<
  geom_point()
```

---

## Diferencia entre color y fill

Vamos a elegir una de las formas con contorno:

```{r fig.height=4}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm)) +
  geom_point(shape = 23)
```

---

## Diferencia entre color y fill

.pull-left[
```{r echo=FALSE, fig.height=3}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm, 
                     color = sex)) + #<<
  geom_point(shape = 23)
```

--

```{r eval=FALSE, include=TRUE}
ggplot(penguins, 
       aes(bill_length_mm, 
           bill_depth_mm, 
           color = sex)) + #<<
  geom_point(shape = 23)
```


]

.pull-right[
```{r echo=FALSE, fig.height=3}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm, 
                     fill = sex)) + #<<
  geom_point(shape = 23)
```

--

```{r eval=FALSE, include=TRUE}
ggplot(penguins, 
       aes(bill_length_mm, 
           bill_depth_mm, 
           fill = sex)) + #<<
  geom_point(shape = 23)
```
]

---

## Diferencia entre color y fill

```{r fig.height=4}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm, 
                     color = island, fill = sex)) + #<<
  geom_point(shape = 23)
```

Poder, se puede pero... ü•¥

---

## Otra aesthetic: `size`

```{r echo=FALSE, fig.height=3}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm, size = island)) +
  geom_point(color = "blue")
```

--

```{r eval=FALSE, include=TRUE}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm, 
                     size = island)) + #<<
  geom_point(color = "blue")
```

---

# El valor de `alpha`

Habitualmente cuando trabajamos con `size` los puntos se solapan

```{r echo=FALSE, fig.height=3}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm, size = island)) +
  geom_point(color = "blue", alpha = .4)
```

--

```{r eval=FALSE, include=TRUE}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm, size = island)) +
  geom_point(color = "blue", alpha = .4) #<<
```

---

# La aesthetic `alpha`

```{r echo=FALSE, fig.height=3}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm, 
                     size = island,
                     alpha = island)) + #<<
  geom_point(color = "blue")
```

--

```{r echo=TRUE, include=FALSE}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm, 
                     size = island,
                     alpha = island)) + #<<
  geom_point(color = "blue")
```

Observa c√≥mo se unifican las leyendas al mapear la misma variable en dos aesthetics.

---

# Resumen

.pull-left[
## `geom_`

- `geom_bar()`
- `geom_point()`
- `geom_hline()`
- `geom_vline()`
- `geom_abline()`
]

.pull-right[
## aesthetics

Pueden ser mapeadas en `aes()` en funci√≥n de una variable o en general para una `geom`.

- `color`
- `fill`
- `alpha`
- `size`
]

---

# Almacenando un objeto

```{r fig.height=4}
p <- ggplot(penguins, aes(bill_length_mm, bill_depth_mm)) +
  geom_point(color = "blue")
p
```

Ahora el objeto `p` est√° disponible para hacer cualquier tipo de modificaci√≥n.

---

# Modificando un objeto

Podemos solapar capas sobre un objeto previamente almacenado

```{r fig.height=3}
p + labs(title="Relaci√≥n bill_depth/bill_length en mm")
```

---

# Temas

El paquete tiene temas predefinidos que permiten modificaciones r√°pidas del aspecto visual.

- `theme_grey`
- `theme_bw`
- `theme_linedraw`
- `theme_light`
- `theme_dark`
- `theme_minimal`
- `theme_classic`
- `theme_void`

---

.pull-left[

```{r fig.height=4}
p + theme_grey()
```

```{r fig.height=4}
p + theme_linedraw()
```


]

.pull-right[

```{r fig.height=4}
p + theme_bw()
```

```{r fig.height=4}
p + theme_light()
```

]

---


.pull-left[

```{r fig.height=4}
p + theme_dark()
```

```{r fig.height=4}
p + theme_classic()
```


]

.pull-right[

```{r fig.height=4}
p + theme_minimal()
```

```{r fig.height=4}
p + theme_void()
```

]

Puedes encontrar m√°s informaci√≥n sobre los temas [aqu√≠](https://ggplot2.tidyverse.org/reference/ggtheme.html).

---

# Otros paquetes que traen temas predeterminados

```{r eval=FALSE}
library(hrbrthemes)
```

---

# Valores continuos en `size`


```{r fig.height=4}
ggplot(penguins, aes(bill_length_mm, 
                     bill_depth_mm, 
                     size = year)) +
  geom_point(color = "blue")
```

---

# Forzar una variable a ser discreta

Ahora queremos dar tama√±o a los puntos en funci√≥n del a√±o en el que fueron recogidos los datos.

Si recordamos la tabla de ping√ºinos, la variable a√±o es num√©rica.

Pero sabesmo que solo hay tres a√±os. Para forzar a que esta variable sea categ√≥rica podemos utilizar `as.factor()`

---

## Forzar una variable a ser discreta

```{r echo=FALSE, fig.height=5}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm, size = as.factor(year))) +
  geom_point(color = "blue")
```

--

```{r eval=FALSE, include=TRUE}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm, size = as.factor(year))) +
  geom_point(color = "blue")
```

---

## Modificar el t√≠tulo de la leyenda

Ahora el t√≠tulo de la leyenda muestra el c√≥digo que hemos utilizado. ¬øC√≥mo podemos cambiarlo?

.pull-left[
```{r echo=FALSE, fig.height=5}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm, size = as.factor(year))) +
  geom_point(color = "blue")
```
]

.pull-right[
```{r echo=FALSE, fig.height=5}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm, size = as.factor(year))) +
  geom_point(color = "blue") +
  labs(size = "A√±o")
```
]

---

## Variable discreta en el eje x

Hasta ahora hemos trabajado con variables continuas en ambos ejes. ¬øQu√© pasa si utilizamos una variable discreta con `geom_point()`? Utilizando body_mass_g para obtener lo siguiente

```{r echo=FALSE, fig.height=3}
ggplot(penguins, aes(species, body_mass_g)) +
  geom_point()
```

--

```{r eval=FALSE, include=TRUE}
ggplot(penguins, aes(species, body_mass_g)) + #<<
  geom_point()
```

---

## Colorear utilizando una variable continua

Hasta ahora hemos trabajado con variables discretas para el color. ¬øQu√© pasa si utilizamos una variable continua? 

```{r fig.height=4}
ggplot(penguins, aes(species, body_mass_g, color = body_mass_g)) +
  geom_point()
```

---

## ¬øQu√© ocurre con `shape`?

Para shape tambi√©n hemos utilizado solo variables discretas, ¬øqu√© pasa si intentamos poner una continua?

---

# Color con variable discreta

Ya conocemos esta forma de colorear utilizando una variable discreta:

```{r fig.height=4}
ggplot(penguins, aes(species, body_mass_g, color = species)) +
  geom_point()
```

--

En esta representaci√≥n los puntos quedan muy solapados, podemos a√±adir algo de aleatoreidad en el eje $x$ para cambiar la representaci√≥n.

---

# A√±adiendo jitter

```{r fig.height=4}
ggplot(penguins, aes(species, body_mass_g, color = species)) +
  geom_jitter(height = 0)
```

---

# Estad√≠stica

```{r fig.height=4}
ggplot(penguins, aes(species, body_mass_g, color = species)) +
  geom_jitter() +
  stat_summary(fun = mean)
```

---

# Aesthetics exclusivas de cada geom

```{r fig.height=4}
ggplot(penguins, aes(species, body_mass_g)) +
  geom_point(aes(color = species)) +
  stat_summary(fun = mean)
```

---

# Aesthetics exclusivas de cada geom

```{r fig.height=4}
ggplot(penguins, aes(species, body_mass_g)) +
  stat_summary(fun = mean, size = 2) +
  geom_point(aes(color = species)) 
```

---

# Comparaci√≥n 

Ambas representaciones producen la misma salida:

```
ggplot(penguins, aes(species, body_mass_g, color = species)) +
  geom_point() 
```

```
ggplot(penguins, aes(species, body_mass_g)) +
  geom_point(aes(color = species)) 
```

Esta produce una salida diferente

```
ggplot(penguins, aes(species, body_mass_g)) +
  geom_point(color = "blue") 
```

---

# Modificando las etiquetas

Otra alternativa:

```{r fig.height=4}
ggplot(penguins, aes(island, species, color = species)) +
  geom_jitter() +
  xlab("Especie") +
  ylab("Isla") 
```


---

## Dos variables discretas

¬øQu√© pasa si queremos hacer un diagrama similar con dos variables discretas?

--

```{r fig.height=4}
ggplot(penguins, aes(island, species, color = species)) +
  geom_point()
```

---

## Utilizando jitter

```{r fig.height=4}
ggplot(penguins, aes(island, species, color = species)) +
  geom_jitter()
```

En este caso podemos permitir aleatoriedad en ambos ejes

---

# Modificando las etiquetas

```{r fig.height=4}
ggplot(penguins, aes(island, species, color = species)) +
  geom_jitter() +
  xlab("Especie") +
  ylab("Isla") 
```

---
class: center, inverse, middle

# Diagramas de barras

---

# Con una sola variable

Ya sabemos hacer un gr√°fico de barras de una sola variable

```{r fig.height=4}
ggplot(penguins, aes(species)) +
  geom_bar()
```

---

# Diagrama de barras

Colorear utilizando el sexo de los ping√ºinos

```{r echo=FALSE, fig.height=3}
ggplot(penguins, aes(species, fill = sex)) +
  geom_bar()
```

--

```{r include=TRUE, eval=FALSE}
ggplot(penguins, aes(species, fill = sex)) +
  geom_bar()
```

--

Est√° representaci√≥n no es muy √∫til para comparar

---

# Diagrama de barras


Un error com√∫n al utilizar `stat_count()` es el siguiente:


```
stat_count() can only have an x or y aesthetic.
```

- Aparece cuando pasamos dos variables en `(aes)`.
- Por ejemplo, al intentar dar color si se nos olvida poner `fill = ` interpreta que queremos dar valor a la `y` y nos encontramos este error.

---

# Posiciones: `stack`

La posici√≥n por defecto es `stack`, que muestra lo mismo que el c√≥digo anterior

```{r fig.height=4}
ggplot(penguins, aes(species, fill = sex)) +
  geom_bar(position = "stack")
```

---

# Posiciones: `dodge`

```{r fig.height=4}
ggplot(penguins, aes(species, fill = sex)) +
  geom_bar(position = "dodge")
```

---

# Posiciones: `dodge`

¬øEn qu√© isla hay m√°s de la especie Adelie?
  - El gr√°fico de la derecha nos permite una comparaci√≥n mejor

.pull-left[
```{r fig.height=4}
ggplot(penguins, 
       aes(island, 
           fill = species)) + 
  geom_bar() #<<
```

]

.pull-right[

```{r fig.height=4}
ggplot(penguins, 
       aes(island, 
           fill = species)) + 
  geom_bar(position = "dodge") #<<
```

]

---

# Etiquetas en posici√≥n `stack`

Otra opci√≥n para comparar es a√±adir etiquetas utilizando `geom_bar()`

```{r fig.height=4}
ggplot(penguins, aes(species, fill = sex)) + 
  geom_bar() +
  geom_text(stat='count', aes(label=..count..), 
            position = position_stack(vjust=.5))
```

---

# Etiquetas en posici√≥n `stack`

```{r eval=FALSE}
ggplot(penguins, aes(species, fill = sex)) + 
  geom_bar() +
  geom_text(stat='count', aes(label=..count..), 
            position = position_stack(vjust=.5))
```

El par√°metro `vjust` representa el ajuste vertical:

- 0 para alinear con la parte de abajo
- 0.5 para alinear en el medio 
- 1 (default) para alinear con la parte de arriba

---

# Etiquetas en posici√≥n `dodge`

```{r fig.height=4}
ggplot(penguins, aes(species, fill = sex)) + 
  geom_bar(position = "dodge") +
  geom_text(stat='count', 
            aes(label=..count..), 
            vjust = -1, 
            position = position_dodge(width = 1))
```

---

# Datos resumidos

Almacenamos en `penguins_total` una variaci√≥n del conjunto de datos original.

```{r fig.height=4}
penguins_total <- penguins %>% # conjunto inicial
  group_by(species, sex) %>% # crear grupos
  count() # contar el num de filas en cada grupo
penguins_total # resultado final
```


---

# Datos resumidos: stat `identity`

Ya no podemos utilizar la stat `count`

```{r fig.height=4}
ggplot(penguins_total, 
       aes(x = species, y = n, fill = sex)) + #<<
  geom_bar(stat = "identity") #<<
```

---

# Datos resumidos: position `dodge`

```{r fig.height=4}
ggplot(penguins_total, 
       aes(x = species, y = n, fill = sex)) +
  geom_bar(stat = "identity", 
           position = "dodge") #<<
```

---
class: center, middle, inverse

# Esquisser

---

# Esquisser

- Herramienta para crear gr√°ficos `ggplot2`.
- Interfaz *drag-and-drop* que permite mapear variables en diferentes aesthetics. 
- Visualizaci√≥n del gr√°fico
- Generaci√≥n din√°mica del c√≥digo

```{r eval=FALSE}
install.packages("esquisse")
esquisse::esquisser()
```

.footnote[
Referencia del paquete en CRAN: https://cran.r-project.org/web/packages/esquisse/index.html

Blog: https://www.business-science.io/code-tools/2021/03/23/ggplot-code-with-tableau-esquisse.html?utm_content=bufferf9d3e&utm_medium=social&utm_source=linkedin.com&utm_campaign=buffer
]

---

# Esquisser

**Ventajas:**

- Interfaz amigable que evita escribir el c√≥digo *from scratch*

**Inconvenientes:**

- Tiene opciones limitadas
- Es un software muy joven ü™≤üêõ

---

# La importancia del c√≥digo

¬øQu√© pasa si queremos hacer este tipo de gr√°ficos?

.pull-left[

**Ejercicio 1**

```{r echo=FALSE, fig.height=5}
ggplot(penguins, aes(island, fill = species)) +
  geom_bar(position = "fill", alpha = .3, color = "black") +
  geom_text(aes(label = ..count..), 
            stat="count", 
            position = position_fill(vjust=.5), 
            fontface = "bold") +
  scale_y_continuous(labels = scales::percent) +
  xlab("Isla") +
  ylab("") +
  guides(fill=guide_legend(title="Especie")) +
  theme_light() +
  theme(panel.grid.minor.x = element_blank(),
        panel.grid.major.y = element_blank()) +
  coord_flip()
```
]

.pull-right[

**Ejercicio 2**

El objetivo es obtener el siguiente gr√°fico:

```{r echo=FALSE, fig.height=5}
ggplot(penguins, aes(bill_length_mm)) +
  geom_histogram(data = penguins %>% filter(sex == "female"), aes(y = ..count.., fill = sex), alpha = .6, color = "black") +
  geom_histogram(data = penguins %>% filter(sex == "male"), aes(y = -..count.., fill = sex), alpha = .6, color = "black") +
  geom_vline(xintercept = penguins %>% pull(bill_length_mm) %>% mean(na.rm = TRUE)) +
  geom_vline(xintercept = penguins %>% filter(sex == "female") %>% pull(bill_length_mm) %>% mean(na.rm = TRUE), color = "green", linetype = "dashed", size = 1.5) +
  geom_vline(xintercept = penguins %>% filter(sex == "male") %>% pull(bill_length_mm) %>% mean(na.rm = TRUE), color = "purple", linetype = "dashed", size = 1.5) +
  geom_label(aes(x=58, y=10, label="hembra"), color = "green", family = "Times", fontface = "bold" ) +
  geom_label(aes(x=58, y=-10, label="macho"), color = "purple", family = "Times", fontface = "bold") + 
  scale_fill_manual(values = c("green", "purple")) +
  labs(title="Histograma de ping√ºinos \ndividido por sexo",
       x ="Longitud del pico", y = "N√∫mero de ping√ºinos") +
  scale_x_continuous(n.breaks = 6) +
  scale_y_continuous(labels=abs) +
  theme_minimal() +
  theme(legend.position = "none", 
        text=element_text(size=16,  family="Times"),
        axis.title.x = element_text(margin=margin(15,0,0,0)),
        axis.title.y = element_text(margin=margin(0,15,0,0)))
```
]

- Comenzar con un diagrama de barras (vertical)
- Ajustar colores
- Ajustar etiquetas
- Cambiar tema
- Invertir ejes

---

# Ejercicio 1

```{r echo=FALSE, fig.height=3}
ggplot(penguins %>% filter(!is.na(sex)), aes(island, fill = species)) +
  geom_bar(position = "fill", alpha = .3, color = "black") +
  geom_text(aes(label = ..count..), stat="count", position = position_fill(vjust=.5), fontface = "bold") +
  scale_y_continuous(labels = scales::percent) +
  xlab("Isla") +
  ylab("") +
  coord_flip() +
  theme_light() +
  guides(fill=guide_legend(title="Especie")) +
  theme(panel.grid.minor.x = element_blank(),
        panel.grid.major.y = element_blank())
```

---

# Ejercicio 1


```{r ref.label="ejBar1", echo=FALSE, fig.height=3}
```

--

```{r ejBar1, eval=FALSE}
ggplot(penguins, aes(island)) +
  geom_bar() 
```


---

# Ejercicio 1


```{r ref.label="ejBar2", echo=FALSE, fig.height=3}
```

--

```{r ejBar2, eval=FALSE}
ggplot(penguins, aes(island, fill = species)) + #<<
  geom_bar() 
```

---

# Ejercicio 1


```{r ref.label="ejBar3", echo=FALSE, fig.height=3}
```

--

```{r ejBar3, eval=FALSE}
ggplot(penguins, aes(island, fill = species)) +
  geom_bar(position = "fill") #<<
```

---

# Ejercicio 1


```{r ref.label="ejBar4", echo=FALSE, fig.height=3}
```

--

```{r ejBar4, eval=FALSE}
ggplot(penguins, aes(island, fill = species)) +
  geom_bar(position = "fill", 
           alpha = .3, color = "black") #<<
```


---

# Ejercicio 1


```{r ref.label="ejBar5", echo=FALSE, fig.height=3}
```

--

```{r ejBar5, eval=FALSE}
ggplot(penguins, aes(island, fill = species)) +
  geom_bar(position = "fill", 
           alpha = .3, color = "black") +
  xlab("Isla") + #<<
  ylab("") #<<
```


---

# Ejercicio 1


```{r ref.label="ejBar6", echo=FALSE, fig.height=3}
```

--

```{r ejBar6, eval=FALSE}
ggplot(penguins, aes(island, fill = species)) +
  geom_bar(position = "fill", alpha = .3, color = "black") +
  xlab("Isla") + 
  ylab("") + 
  guides(fill=guide_legend(title="Especie")) #<<
```

---

# Ejercicio 1


```{r ref.label="ejBar7", echo=FALSE, fig.height=3}
```

--

```{r ejBar7, eval=FALSE}
ggplot(penguins, aes(island, fill = species)) +
  geom_bar(position = "fill", alpha = .3, color = "black") +
  xlab("Isla") +
  ylab("") +
  guides(fill=guide_legend(title="Especie")) +
  theme_light() #<<
```


---

# Ejercicio 1

```{r ref.label="ejBar8", echo=FALSE, fig.height=3}
```

--

```{r ejBar8, eval=FALSE}
ggplot(penguins, aes(island, fill = species)) +
  geom_bar(position = "fill", alpha = .3, color = "black") +
  scale_y_continuous(labels = scales::percent) + #<<
  xlab("Isla") +
  ylab("") +
  guides(fill=guide_legend(title="Especie")) +
  theme_light() 
```

---

# Ejercicio 1

```{r ref.label="ejBar9", echo=FALSE, fig.height=3}
```

--

```{r ejBar9, eval=FALSE}
ggplot(penguins, aes(island, fill = species)) +
  geom_bar(position = "fill", alpha = .3, color = "black") +
  geom_text(aes(label = ..count..), #<<
            stat="count", #<<
            position = position_fill(vjust=.5), #<<
            fontface = "bold") + #<<
  scale_y_continuous(labels = scales::percent) +
  xlab("Isla") +
  ylab("") +
  guides(fill=guide_legend(title="Especie")) +
  theme_light() 
```


---

# Ejercicio 1

```{r ref.label="ejBar10", echo=FALSE, fig.height=3}
```

--

```{r ejBar10, eval=FALSE}
ggplot(penguins, aes(island, fill = species)) +
  geom_bar(position = "fill", alpha = .3, color = "black") +
  geom_text(aes(label = ..count..), stat="count", 
            position = position_fill(vjust=.5), 
            fontface = "bold") +
  scale_y_continuous(labels = scales::percent) +
  xlab("Isla") + ylab("") +
  guides(fill=guide_legend(title="Especie")) +
  theme_light() +
  theme(panel.grid.minor.x = element_blank())
```

---

# Ejercicio 1

```{r ref.label="ejBar11", echo=FALSE, fig.height=3}
```

--

```{r ejBar11, eval=FALSE}
ggplot(penguins, aes(island, fill = species)) +
  geom_bar(position = "fill", alpha = .3, color = "black") +
  geom_text(aes(label = ..count..), 
            stat="count", 
            position = position_fill(vjust=.5), 
            fontface = "bold") +
  scale_y_continuous(labels = scales::percent) +
  xlab("Isla") +
  ylab("") +
  guides(fill=guide_legend(title="Especie")) +
  theme_light() +
  theme(panel.grid.minor.x = element_blank(),
        panel.grid.major.y = element_blank())
```

---

# Ejercicio 1

```{r ref.label="ejBar12", echo=FALSE, fig.height=3}
```

--

```{r ejBar12, eval=FALSE}
ggplot(penguins, aes(island, fill = species)) +
  geom_bar(position = "fill", alpha = .3, color = "black") +
  geom_text(aes(label = ..count..), 
            stat="count", 
            position = position_fill(vjust=.5), 
            fontface = "bold") +
  scale_y_continuous(labels = scales::percent) +
  xlab("Isla") +
  ylab("") +
  guides(fill=guide_legend(title="Especie")) +
  theme_light() +
  theme(panel.grid.minor.x = element_blank(),
        panel.grid.major.y = element_blank()) +
  coord_flip()
```



```{r}
ggplot(penguins, aes(island, fill = species)) +
  geom_bar(position = "fill", 
           alpha = 0.3, 
           color = "black") +
  geom_text(aes(label = ..count..), 
            stat = "count",
            position = position_fill(vjust = 0.5),
            fontface = "bold") +
  scale_y_continuous(labels = scales::percent) +
  xlab("Isla") + 
  ylab("") +
  guides(fill = guide_legend(title = "Especie")) +
  theme_light() +
  theme(panel.grid.major.x = element_blank(),
        panel.grid.minor.y = element_blank()) +
  coord_flip()
```



---

# Ejercicio 2

Histograma b√°sico de la variable `bill_length_mm`

```{r ref.label="ejHisto1", echo=FALSE, fig.height=3}
```

--

```{r ejHisto1, eval=FALSE}
ggplot(penguins, aes(bill_length_mm)) +
  geom_histogram()
```

---

# Ejercicio 2

Qu√© pasa si le doy ¬øcolor?

```{r ref.label="ejHisto2", echo=FALSE, fig.height=3}
```

--

```{r ejHisto2, eval=FALSE}
ggplot(penguins, aes(bill_length_mm)) +
  geom_histogram(color = "orange")
```

---

# Ejercicio 2

Para colorear el interior tengo que cambiar `fill`

```{r ref.label="ejHisto3", echo=FALSE, fig.height=3}
```

--

```{r ejHisto3, eval=FALSE}
ggplot(penguins, aes(bill_length_mm)) +
  geom_histogram(fill = "orange")
```

---

# Ejercicio 2

Ambas pueden ponerse a la vez

```{r ref.label="ejHisto4", echo=FALSE, fig.height=3}
```

--

```{r ejHisto4, eval=FALSE}
ggplot(penguins, aes(bill_length_mm)) +
  geom_histogram(fill = "orange", color = "black")
```

---

# Ejercicio 2

Vamos a darle transparencia utilizando la est√©tica `alpha`

```{r ref.label="ejHisto5", echo=FALSE, fig.height=3}
```

--

```{r ejHisto5, eval=FALSE}
ggplot(penguins, aes(bill_length_mm)) +
  geom_histogram(fill = "orange", color = "black")
```

---

# Ejercicio 2

Rellenar en funci√≥n del sexo del ping√ºino

```{r ref.label="ejHisto6", echo=FALSE, fig.height=3}
```

--

```{r ejHisto6, eval=FALSE, fig.height=3}
ggplot(penguins, aes(bill_length_mm, fill = sex)) +
  geom_histogram(color = "black", alpha = 0.6)
```


---

# Ejercicio 2

Rellenar en funci√≥n del sexo del ping√ºino

```{r ref.label="ejHisto7", echo=FALSE, fig.height=3}
```

--

```{r ejHisto7, eval=FALSE}
ggplot(penguins, aes(x = bill_length_mm, fill = sex)) +
  geom_histogram(aes(y = ..count..), color = "black", alpha = 0.6)
```

---

# Ejercicio 2

Hacer el efecto espejo con todos los datos

```{r ref.label="ejHisto8", echo=FALSE, fig.height=3}
```

--

```{r ejHisto8, eval=FALSE, fig.height=3}
ggplot(penguins, aes(x = bill_length_mm, fill = sex)) +
  geom_histogram(aes(y = ..count..), color = "black", alpha = 0.6) +
  geom_histogram(aes(y = -..count..), color = "black", alpha = 0.6)
```

---

# Ejercicio 2

Filtrar cada una de las capas para que utilice un subconjunto de los datos

```{r ref.label="ejHisto9", echo=FALSE, fig.height=3}
```

--

```{r ejHisto9, eval=FALSE, fig.height=3}
ggplot(penguins, aes(x = bill_length_mm, fill = sex)) +
  geom_histogram(data = penguins %>% filter(sex == "female"), 
                 aes(y = ..count..), color = "black", alpha = 0.6) +
  geom_histogram(data = penguins %>% filter(sex == "male"),
                 aes(y = -..count..), color = "black", alpha = 0.6)
```

---

# Ejercicio 2

A√±adir una nueva capa con una etiqueta para indicar macho y hembra

```{r ref.label="ejHisto10", echo=FALSE, fig.height=3}
```

--

```{r ejHisto10, eval=FALSE}
ggplot(penguins, aes(x = bill_length_mm, fill = sex)) +
  geom_histogram(data = penguins %>% filter(sex == "female"), 
                 aes(y = ..count..), color = "black", alpha = 0.6) +
  geom_histogram(data = penguins %>% filter(sex == "male"), 
                 aes(y = -..count..), color = "black", alpha = 0.6) +
  geom_label(aes(x = 58, y = 10, label = "hembra")) +
  geom_label(aes(x = 58, y = -10, label = "macho"))
```

---

# Ejercicio 2

Quitar la leyenda

```{r ref.label="ejHisto11", echo=FALSE, fig.height=3}
```

--

```{r ejHisto11, eval=FALSE}
ggplot(penguins, aes(x = bill_length_mm, fill = sex)) +
  geom_histogram(data = penguins %>% filter(sex == "female"), 
                 aes(y = ..count..), color = "black", alpha = 0.6) +
  geom_histogram(data = penguins %>% filter(sex == "male"), 
                 aes(y = -..count..), color = "black", alpha = 0.6) +
  geom_label(aes(x = 58, y = 10, label = "hembra")) +
  geom_label(aes(x = 58, y = -10, label = "macho")) +
  theme(legend.position = "none")
```

---

# Ejercicio 2

Cambiar los colores de forma manual

```{r ref.label="ejHisto12", echo=FALSE, fig.height=3}
```

--

```{r ejHisto12, eval=FALSE}
ggplot(penguins, aes(x = bill_length_mm)) +
  geom_histogram(data = penguins %>% filter(sex == "female"), 
                 aes(y = ..count.., fill = sex), color = "black", alpha = 0.6) +
  geom_histogram(data = penguins %>% filter(sex == "male"), 
                 aes(y = -..count.., fill = sex), color = "black", alpha = 0.6) +
  geom_label(aes(x = 58, y = 10, label = "hembra"), color = "green") +
  geom_label(aes(x = 58, y = -10, label = "macho"), color = "purple") +
  scale_fill_manual(values = c("green", "purple")) +
  theme(legend.position = "none")

```

---

# Ejercicio 2

Cambiar el tema. Pero ojo que as√≠ no funciona

```{r ref.label="ejHisto13", echo=FALSE, fig.height=3}
```

--

```{r ejHisto13, eval=FALSE}
ggplot(penguins, aes(x = bill_length_mm)) +
  geom_histogram(data = penguins %>% filter(sex == "female"), 
                 aes(y = ..count.., fill = sex), color = "black", alpha = 0.6) +
  geom_histogram(data = penguins %>% filter(sex == "male"), 
                 aes(y = -..count.., fill = sex), color = "black", alpha = 0.6) +
  geom_label(aes(x = 58, y = 10, label = "hembra"), color = "green") +
  geom_label(aes(x = 58, y = -10, label = "macho"), color = "purple") +
  scale_fill_manual(values = c("green", "purple")) +
  theme(legend.position = "none") +
  theme_minimal()
```


---

# Ejercicio 2

Es importante el orden de las capas del tema

```{r ref.label="ejHisto14", echo=FALSE, fig.height=3}
```

--

```{r ejHisto14, eval=FALSE}
ggplot(penguins, aes(x = bill_length_mm)) +
  geom_histogram(data = penguins %>% filter(sex == "female"), 
                 aes(y = ..count.., fill = sex), color = "black", alpha = 0.6) +
  geom_histogram(data = penguins %>% filter(sex == "male"), 
                 aes(y = -..count.., fill = sex), color = "black", alpha = 0.6) +
  geom_label(aes(x = 58, y = 10, label = "hembra"), color = "green") +
  geom_label(aes(x = 58, y = -10, label = "macho"), color = "purple") +
  scale_fill_manual(values = c("green", "purple")) +
  theme_minimal() +
  theme(legend.position = "none")
```

---

# Ejercicio 2

Cambiar la fuente del tema

```{r ref.label="ejHisto15", echo=FALSE, fig.height=3}
```

--

```{r ejHisto15, eval=FALSE}
ggplot(penguins, aes(x = bill_length_mm)) +
  geom_histogram(data = penguins %>% filter(sex == "female"), 
                 aes(y = ..count.., fill = sex), color = "black", alpha = 0.6) +
  geom_histogram(data = penguins %>% filter(sex == "male"), 
                 aes(y = -..count.., fill = sex), color = "black", alpha = 0.6) +
  geom_label(aes(x = 58, y = 10, label = "hembra"), color = "green") +
  geom_label(aes(x = 58, y = -10, label = "macho"), color = "purple") +
  scale_fill_manual(values = c("green", "purple")) +
  theme_minimal() +
  theme(legend.position = "none",
        text = element_text(family = "Times", size = 16)) # aqu√≠ en windows TT Times New Roman
```

---

# Ejercicio 2

Nota, las fuentes dependen del sistema operativo que est√©s utilizando:


---

# Ejercicio 2

Cambiar las etiquetas x e y

```{r ref.label="ejHisto16", echo=FALSE, fig.height=3}
```

--

```{r ejHisto16, eval=FALSE}
ggplot(penguins, aes(x = bill_length_mm)) +
  geom_histogram(data = penguins %>% filter(sex == "female"), 
                 aes(y = ..count.., fill = sex), color = "black", alpha = 0.6) +
  geom_histogram(data = penguins %>% filter(sex == "male"), 
                 aes(y = -..count.., fill = sex), color = "black", alpha = 0.6) +
  geom_label(aes(x = 58, y = 10, label = "hembra"), color = "green") +
  geom_label(aes(x = 58, y = -10, label = "macho"), color = "purple") +
  scale_fill_manual(values = c("green", "purple")) +
  xlab("Longitud del pico") +
  ylab("N√∫mero de ping√ºinos") +
  theme_minimal() +
  theme(legend.position = "none",
        text = element_text(family = "Times", size = 16)) # aqu√≠ en windows TT Times New Roman
```


---

# Ejercicio 2

Otra alternativa para cambiar las etiquetas x e y

```{r ref.label="ejHisto18", echo=FALSE, fig.height=3}
```

--

```{r ejHisto18, eval=FALSE}

ggplot(penguins, aes(x = bill_length_mm)) +
  geom_histogram(data = penguins %>% filter(sex == "female"), 
                 aes(y = ..count.., fill = sex), color = "black", alpha = 0.6) +
  geom_histogram(data = penguins %>% filter(sex == "male"), 
                 aes(y = -..count.., fill = sex), color = "black", alpha = 0.6) +
  geom_label(aes(x = 58, y = 10, label = "hembra"), color = "green") +
  geom_label(aes(x = 58, y = -10, label = "macho"), color = "purple") +
  scale_fill_manual(values = c("green", "purple")) +
  labs(title = "Histograma de ping√ºinos",
       x = "Longitud del pico", 
       y = "N√∫mero de ping√ºinos") +
  theme_minimal() +
  theme(legend.position = "none",
        text = element_text(family = "Times", size = 16)) # aqu√≠ en windows TT Times New Roman
```

---

# Ejercicio 2

Indicar saltos de l√≠nea en las etiquetas

```{r ref.label="ejHisto19", echo=FALSE, fig.height=3}
```

--

```{r ejHisto19, eval=FALSE}
ggplot(penguins, aes(x = bill_length_mm)) +
  geom_histogram(data = penguins %>% filter(sex == "female"), 
                 aes(y = ..count.., fill = sex), color = "black", alpha = 0.6) +
  geom_histogram(data = penguins %>% filter(sex == "male"), 
                 aes(y = -..count.., fill = sex), color = "black", alpha = 0.6) +
  geom_label(aes(x = 58, y = 10, label = "hembra"), color = "green") +
  geom_label(aes(x = 58, y = -10, label = "macho"), color = "purple") +
  scale_fill_manual(values = c("green", "purple")) +
  labs(title = "Histograma de ping√ºinos \ndividido por sexo",
       x = "Longitud del pico", 
       y = "N√∫mero de ping√ºinos") +
  theme_minimal() +
  theme(legend.position = "none",
        text = element_text(family = "Times", size = 16)) # aqu√≠ en windows TT Times New Roman
```

---

# Ejercicio 2

Transformaci√≥n del eje y: cambiar etiquetas

```{r ref.label="ejHisto20", echo=FALSE, fig.height=3}
```

--

```{r ejHisto20, eval=FALSE}
ggplot(penguins, aes(x = bill_length_mm)) +
  geom_histogram(data = penguins %>% filter(sex == "female"), 
                 aes(y = ..count.., fill = sex), color = "black", alpha = 0.6) +
  geom_histogram(data = penguins %>% filter(sex == "male"), 
                 aes(y = -..count.., fill = sex), color = "black", alpha = 0.6) +
  geom_label(aes(x = 58, y = 10, label = "hembra"), color = "green") +
  geom_label(aes(x = 58, y = -10, label = "macho"), color = "purple") +
  scale_y_continuous(label = abs) +
  scale_fill_manual(values = c("green", "purple")) +
  labs(title = "Histograma de ping√ºinos \ndividido por sexo",
       x = "Longitud del pico", 
       y = "N√∫mero de ping√ºinos") +
  theme_minimal() +
  theme(legend.position = "none",
        text = element_text(family = "Times", size = 16)) # aqu√≠ en windows TT Times New Roman
```

---

# Ejercicio 2

Transformaci√≥n del eje x: a√±adir m√°s breaks

```{r ref.label="ejHisto21", echo=FALSE, fig.height=3}
```

--

```{r ejHisto21, eval=FALSE}
ggplot(penguins, aes(x = bill_length_mm)) +
  geom_histogram(data = penguins %>% filter(sex == "female"), 
                 aes(y = ..count.., fill = sex), color = "black", alpha = 0.6) +
  geom_histogram(data = penguins %>% filter(sex == "male"), 
                 aes(y = -..count.., fill = sex), color = "black", alpha = 0.6) +
  geom_label(aes(x = 58, y = 10, label = "hembra"), color = "green") +
  geom_label(aes(x = 58, y = -10, label = "macho"), color = "purple") +
  scale_x_continuous(n.breaks = 6) +
  scale_y_continuous(label = abs) +
  scale_fill_manual(values = c("green", "purple")) +
  labs(title = "Histograma de ping√ºinos \ndividido por sexo",
       x = "Longitud del pico", 
       y = "N√∫mero de ping√ºinos") +
  theme_minimal() +
  theme(legend.position = "none",
        text = element_text(family = "Times", size = 16)) # aqu√≠ en windows TT Times New Roman

```

---

# Ejercicio 2

Cambiar el tipo de family de geom_label

```{r ref.label="ejHisto22", echo=FALSE, fig.height=3}
```

--

```{r ejHisto22, eval=FALSE}
ggplot(penguins, aes(x = bill_length_mm)) +
  geom_histogram(data = penguins %>% filter(sex == "female"), 
                 aes(y = ..count.., fill = sex), color = "black", alpha = 0.6) +
  geom_histogram(data = penguins %>% filter(sex == "male"), 
                 aes(y = -..count.., fill = sex), color = "black", alpha = 0.6) +
  geom_label(aes(x = 58, y = 10, label = "hembra"), color = "green", family = "Times") +
  geom_label(aes(x = 58, y = -10, label = "macho"), color = "purple", family = "Times") +
  scale_x_continuous(n.breaks = 6) +
  scale_y_continuous(label = abs) +
  scale_fill_manual(values = c("green", "purple")) +
  labs(title = "Histograma de ping√ºinos \ndividido por sexo",
       x = "Longitud del pico", 
       y = "N√∫mero de ping√ºinos") +
  theme_minimal() +
  theme(legend.position = "none",
        text = element_text(family = "Times", size = 16))
```

---

# Ejercicio 2

Separar las etiquetas de los ejes de los ticks

```{r ref.label="ejHisto23", echo=FALSE, fig.height=3}
```

--

```{r ejHisto23, eval=FALSE}
ggplot(penguins, aes(x = bill_length_mm)) +
  geom_histogram(data = penguins %>% filter(sex == "female"), 
                 aes(y = ..count.., fill = sex), color = "black", alpha = 0.6) +
  geom_histogram(data = penguins %>% filter(sex == "male"), 
                 aes(y = -..count.., fill = sex), color = "black", alpha = 0.6) +
  geom_label(aes(x = 58, y = 10, label = "hembra"), color = "green", family = "Times") +
  geom_label(aes(x = 58, y = -10, label = "macho"), color = "purple", family = "Times") +
  scale_x_continuous(n.breaks = 6) +
  scale_y_continuous(label = abs) +
  scale_fill_manual(values = c("green", "purple")) +
  labs(title = "Histograma de ping√ºinos \ndividido por sexo",
       x = "Longitud del pico", 
       y = "N√∫mero de ping√ºinos") +
  theme_minimal() +
  theme(legend.position = "none",
        text = element_text(family = "Times", size = 16),
        axis.title.x = element_text(margin = margin(15,0,0,0)),
        axis.title.y = element_text(margin = margin(r = 15)))
```

---

# Ejercicio 2

Introducir l√≠neas verticales para mostrar la media

```{r ref.label="ejHisto24", echo=FALSE, fig.height=3}
```

--

```{r ejHisto24, eval=FALSE}
ggplot(penguins, aes(x = bill_length_mm)) +
  geom_histogram(data = penguins %>% filter(sex == "female"), 
                 aes(y = ..count.., fill = sex), color = "black", alpha = 0.6) +
  geom_histogram(data = penguins %>% filter(sex == "male"), 
                 aes(y = -..count.., fill = sex), color = "black", alpha = 0.6) +
  geom_label(aes(x = 58, y = 10, label = "hembra"), color = "green", family = "Times") +
  geom_label(aes(x = 58, y = -10, label = "macho"), color = "purple", family = "Times") +
  geom_vline(xintercept = penguins %>% pull(bill_length_mm) %>% mean(na.rm = TRUE)) +
  scale_x_continuous(n.breaks = 6) +
  scale_y_continuous(label = abs) +
  scale_fill_manual(values = c("green", "purple")) +
  labs(title = "Histograma de ping√ºinos \ndividido por sexo",
       x = "Longitud del pico", 
       y = "N√∫mero de ping√ºinos") +
  theme_minimal() +
  theme(legend.position = "none",
        text = element_text(family = "Times", size = 16),
        axis.title.x = element_text(margin = margin(15,0,0,0)),
        axis.title.y = element_text(margin = margin(r = 15)))
```

# Ejercicio 2

A√±adir medias filtrando por sexo

```{r ref.label="ejHisto25", echo=FALSE, fig.height=3}
```

--

```{r ejHisto25, eval=FALSE}
ggplot(penguins, aes(x = bill_length_mm)) +
  geom_histogram(data = penguins %>% filter(sex == "female"), 
                 aes(y = ..count.., fill = sex), color = "black", alpha = 0.6) +
  geom_histogram(data = penguins %>% filter(sex == "male"), 
                 aes(y = -..count.., fill = sex), color = "black", alpha = 0.6) +
  geom_label(aes(x = 58, y = 10, label = "hembra"), color = "green", family = "Times") +
  geom_label(aes(x = 58, y = -10, label = "macho"), color = "purple", family = "Times") +
  geom_vline(xintercept = penguins %>% pull(bill_length_mm) %>% mean(na.rm = TRUE), size = 2) +
  geom_vline(xintercept = penguins %>% filter(sex == "female") %>% pull(bill_length_mm) %>% mean(na.rm = TRUE), color = "green", linetype = "dashed") +
  geom_vline(xintercept = penguins %>% filter(sex == "male") %>% pull(bill_length_mm) %>% mean(na.rm = TRUE), color = "purple", linetype = "dashed") +
  scale_x_continuous(n.breaks = 6) +
  scale_y_continuous(label = abs) +
  scale_fill_manual(values = c("green", "purple")) +
  labs(title = "Histograma de ping√ºinos \ndividido por sexo",
       x = "Longitud del pico", 
       y = "N√∫mero de ping√ºinos") +
  theme_minimal() +
  theme(legend.position = "none",
        text = element_text(family = "Times", size = 16),
        axis.title.x = element_text(margin = margin(15,0,0,0)),
        axis.title.y = element_text(margin = margin(r = 15)))
```


---

# Ejercicio 2

Modificaciones sobre la letra que tiene geom_label

```{r ref.label="ejHisto26", echo=FALSE, fig.height=3}
```

--

```{r ejHisto26, eval=FALSE}
ggplot(penguins, aes(x = bill_length_mm)) +
  geom_histogram(data = penguins %>% filter(sex == "female"), 
                 aes(y = ..count.., fill = sex), color = "black", alpha = 0.6) +
  geom_histogram(data = penguins %>% filter(sex == "male"), 
                 aes(y = -..count.., fill = sex), color = "black", alpha = 0.6) +
  geom_label(aes(x = 58, y = 10, label = "hembra"), color = "green", family = "Times", fontface = "bold") +
  geom_label(aes(x = 58, y = -10, label = "macho"), color = "purple", family = "Times", fontface = "bold") +
  geom_vline(xintercept = penguins %>% pull(bill_length_mm) %>% mean(na.rm = TRUE), size = 2) +
  geom_vline(xintercept = penguins %>% filter(sex == "female") %>% pull(bill_length_mm) %>% mean(na.rm = TRUE), color = "green", linetype = "dashed") +
  geom_vline(xintercept = penguins %>% filter(sex == "male") %>% pull(bill_length_mm) %>% mean(na.rm = TRUE), color = "purple", linetype = "dashed") +
  scale_x_continuous(n.breaks = 6) +
  scale_y_continuous(label = abs) +
  scale_fill_manual(values = c("green", "purple")) +
  labs(title = "Histograma de ping√ºinos \ndividido por sexo",
       x = "Longitud del pico", 
       y = "N√∫mero de ping√ºinos") +
  theme_minimal() +
  theme(legend.position = "none",
        text = element_text(family = "Times", size = 16),
        axis.title.x = element_text(margin = margin(15,0,0,0)),
        axis.title.y = element_text(margin = margin(r = 15)))

```


---

# Ejercicio 2

Utilizando un tema que es de otro paquete (hrbrthemes)

```{r ref.label="ejHisto27", echo=FALSE, fig.height=3}
```

--

```{r ejHisto27, eval=FALSE}
library(hrbrthemes)
ggplot(penguins, aes(x = bill_length_mm)) +
  geom_histogram(data = penguins %>% filter(sex == "female"), 
                 aes(y = ..count.., fill = sex), color = "black", alpha = 0.6) +
  geom_histogram(data = penguins %>% filter(sex == "male"), 
                 aes(y = -..count.., fill = sex), color = "black", alpha = 0.6) +
  geom_label(aes(x = 58, y = 10, label = "hembra"), color = "green", family = "Times", fontface = "bold") +
  geom_label(aes(x = 58, y = -10, label = "macho"), color = "purple", family = "Times", fontface = "bold") +
  geom_vline(xintercept = penguins %>% pull(bill_length_mm) %>% mean(na.rm = TRUE), size = 2) +
  geom_vline(xintercept = penguins %>% filter(sex == "female") %>% pull(bill_length_mm) %>% mean(na.rm = TRUE), color = "green", linetype = "dashed") +
  geom_vline(xintercept = penguins %>% filter(sex == "male") %>% pull(bill_length_mm) %>% mean(na.rm = TRUE), color = "purple", linetype = "dashed") +
  scale_x_continuous(n.breaks = 6) +
  scale_y_continuous(label = abs) +
  scale_fill_manual(values = c("green", "purple")) +
  labs(title = "Histograma de ping√ºinos \ndividido por sexo",
       x = "Longitud del pico", 
       y = "N√∫mero de ping√ºinos") +
  theme_ipsum() +
  theme(legend.position = "none",
        text = element_text(family = "Times", size = 16),
        axis.title.x = element_text(margin = margin(15,0,0,0)),
        axis.title.y = element_text(margin = margin(r = 15)))
```

---
class: inverse, center, middle

# Lollipop üç≠

---

# Lollipop üç≠

.pull-left[
Gr√°fico de barras:

```{r echo=FALSE, fig.height=5}
ggplot(penguins, aes(island)) + stat_count()
```
]

.pull-right[

Objetivo:

```{r ref.label="lollipopFin", echo=FALSE, fig.height=5}
```

]

.footnote[
Otras variaciones m√°s complejas del gr√°fico de barras que se est√°n popularizando: [Circular barl plots]()https://www.r-graph-gallery.com/297-circular-barplot-with-groups.html)]

---

# Lollipop üç≠

```{r fig.height=2}
penguins_group <- penguins %>% group_by(island) %>% count()
ggplot(penguins_group, aes(island, n)) +
  geom_segment(aes(x=island ,xend=island, y=0, yend=n)) +
  geom_point()
```

.footnote[
https://www.r-graph-gallery.com/300-basic-lollipop-plot.html
https://www.r-graph-gallery.com/304-highlight-a-group-in-lollipop.html
]
---

# Lollipop üç≠

```{r ref.label="lollipop1", echo=FALSE, fig.height=3}
```

```{r lollipop1, eval=FALSE}
penguins_group <- penguins %>% group_by(island) %>% count()
ggplot(penguins_group, aes(island, n)) +
  geom_segment(aes(x=island ,xend=island, y=0, yend=n)) +
  geom_point(size = 7, shape = 21, color = "black", fill = "pink") +
  theme_bw()
```

---

# Lollipop üç≠

```{r fig.height=2}
penguins_group <- penguins %>% group_by(island) %>% count()
ggplot(penguins_group, aes(island, n)) +
  geom_segment(aes(x=island ,xend=island, y=0, yend=n), color = "grey", size = 2) +
  geom_point(size = 7, shape = 21, color = "black", fill = "pink") +
  scale_y_continuous(n.breaks = 10) + 
  coord_flip() +
  theme_bw() 
```

---

# Lollipop üç≠

```{r ref.label="lollipopFin", echo=FALSE, fig.height=3}
```

```{r lollipopFin, eval=FALSE}
penguins_group <- penguins %>% group_by(island) %>% count()
ggplot(penguins_group, aes(island, n)) +
  geom_segment(aes(x=island ,xend=island, y=0, yend=n), color = "grey", size = 2) +
  geom_point(size = 8, shape = 21, color = "black", fill = "pink") +
  geom_text(aes(label = n), color = "white") +
  scale_y_continuous(n.breaks = 10) + 
  coord_flip() +
  theme_bw() 
```

---

# Lollipop üç≠

```{r}
penguins_resumen <- penguins %>% 
  group_by(island) %>% 
  count()

ggplot(penguins_resumen, aes(island, n)) +
  geom_segment(aes(x=island, xend=island,
                   y=0, yend=n),
               color = "grey",
               size = 2) +
  geom_point(size = 8, shape = 21, 
             fill = "#fabada") +
  scale_y_continuous(n.breaks = 10) +
  theme_bw() +
  coord_flip()
```

---
class: inverse, center, middle

# Facets

---

# Facets: `facet_wrap`

```{r fig.height=4}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm)) +
  geom_point() +
  facet_wrap(.~species)
```

---

# Facets: cambiando el layout

```{r fig.height=4}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm)) +
  geom_point() +
  facet_wrap(.~species, nrow = 3)
```

---
# Facets: liberando los ejes

```{r fig.height=4}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm)) +
  geom_point() + 
  facet_wrap(~species, scales = "free")
```

---

# Facets: `facet_grid`

Dividiendo en funci√≥n a dos variables

```{r fig.height=4}
ggplot(penguins, aes(bill_length_mm, bill_depth_mm)) +
  geom_point() + 
  facet_grid(island~species, scales = "free") #<<
```

---

# Diferencia entre `facet_wrap` y `facet_grid`

```{r fig.height=3}
ggplot(penguins, aes(bill_length_mm,
                     bill_depth_mm)) +
  geom_point() +
  facet_wrap(island ~ species, scales = "free")
```

---

# Diferencia entre `facet_wrap` y `facet_grid`

- Como vemos, tambi√©n podr√≠amos hacer comparaciones de dos variables con `facet_wrap`
- Excepto en casos excepcionales, para dos varaibles utilizaremos `facet_grid`

.footnote[[Hilo de StackOverflow sobre la diferencia entre esto](https://stackoverflow.com/questions/20457905/whats-the-difference-between-facet-wrap-and-facet-grid-in-ggplot2)]

---
class: inverse, center, middle

# Waffle

---

# Waffle

.pull-left[
- Cuadr√≠cula de celdas cuyos *colores* representan los datos.
  - Tambi√©n pueden utilizarse formas, iconos... y combinaciones de estos
- Buena forma de mostrar el progreso hacia un objetivo. 
- Tambi√©n √∫til para representar la divisi√≥n de un total por grupos.

```{r}
library("waffle")
```
]

.pull-right[
```{r fig.height=5}
# N√∫mero de cuadrados 
# correspondiente a cada clase
valores <- c(43, 11, 21, 
             8, 2, 15)
waffle(valores)
```
]

```{r ref.label="waffle1Objetivo", echo=FALSE}
```


---

# Waffle

Para asignas nombres a cada una de las clases se utilizan un vector con nombres

```{r fig.height=5}
valores <- c(43, 11, 21, 8, 2, 15)
names(valores) <- c("Clase 1", "Clase 2", "Clase 3",
                    "Clase 4", "Clase 5", "Clase 6")
waffle(valores)
```

---

# Waffle

Ejemplo: *¬øCu√°ntos diamantes hay atendiendo a su tipo de corte?*

Es necesario un vector a partir de los datos:

```{r}
diamonds %>%
    group_by(cut) %>%
    count()
```

---

# Waffle

Contar el n√∫mero de cuadros correspondientes

```{r}
diamonds %>%
    group_by(cut) %>%
    count() %>% 
    mutate(n = round((n / nrow(diamonds))*100),1) %>% 
    deframe()
```

---

# Waffle

```{r waffle1Objetivo, eval=FALSE, fig.height=3}
waffle(
  diamonds %>%
    group_by(cut) %>%
    count() %>% 
    mutate(n = round((n / nrow(diamonds))*100),1) %>%
    deframe(), # hasta aqu√≠ el dataframe
    rows = 5, xlab = "Diamantes seg√∫n su corte")
```

---

# Waffle

```{r fig.height=3}
waffle(
diamonds %>%
  group_by(cut) %>%
  count() %>% 
  mutate(n = round((n / nrow(diamonds))*100),1) %>%
  deframe(), rows = 10, size = 0.4, flip = TRUE, 
  title = "Diamantes seg√∫n su corte",
  xlab = "Cada cuadro representa aproximadamente 540 diamantes",
  )
```

.footnote[[https://github.com/hrbrmstr/waffle](https://github.com/hrbrmstr/waffle)]

---
class: inverse, center, middle

# Nube de palabras 

---

# Wordcloud

Existen dos paquetes diferentes

Para im√°genes est√°ticas:

```{r}
library(wordcloud)
```

Para im√°genes din√°micas:

```{r}
library(wordcloud2)
```

---

# Wordcloud

En primer lugar es necesario tener los datos en un formato correcto. El objetivo es:
- Formato tabular con dos columnas:
  - `palabra` la palabra a mostrar
  - `freq` la frecuencia con la que aparece esa palabra
  
```{r}
library(tidytext)
palabras <- harrypotter::chamber_of_secrets[1] %>% 
  as_tibble() %>% 
  unnest_tokens(palabra, value) %>% 
  group_by(palabra) %>% 
  count()
```

---

# Wordcloud

```{r include=FALSE}
set.seed(1234) 
```

```{r fig.height=4}
wordcloud(words = palabras$palabra, freq = palabras$n, 
          min.freq = 1,max.words=200, 
          random.order=FALSE, rot.per=0.35, 
          colors=brewer.pal(8, "Dark2"))
```

---

# Wordcloud

- Cada ejecuci√≥n elige aleatoriamente
- Para reproducir siempre la misma nube debemos *fijar una semilla*

```{r}
set.seed(1234) # Fijar la semilla en un n√∫mero aleatorio
wordcloud(words = palabras$palabra, freq = palabras$n, 
          min.freq = 1,max.words=200, 
          random.order=FALSE, rot.per=0.35, 
          colors=brewer.pal(8, "Dark2"))
```

---

# Wordcloud interactivo

La segunda versi√≥n del paquete genera una imagen en formato `.html` con el que se puede interactuar.

```{r fig.height=4}
wordcloud2(palabras)
```

---

# Wordcloud interactivo

```{r fig.height=4}
wordcloud2(palabras, size=0.6, shape = 'star', 
           backgroundColor = "white", color="#69b3a2")
```

Al pasar el rat√≥n por encima muestra el n√∫mero de apariciones de la palabra.

---

# Leer texto propio

Para cargar el texto desde un archivo

```{r eval = FALSE}
fileName <- "nombre_archivo.txt"
texto <- readChar(fileName, file.info(fileName)$size)
```

```{r include=FALSE}
texto <- "
Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin placerat lacus vel magna varius placerat. Nulla eu elit purus. Morbi vitae augue tristique, blandit odio nec, efficitur turpis. Duis at vestibulum justo, id ultricies nunc. Quisque urna metus, imperdiet venenatis rhoncus non, varius vehicula nisi. Mauris interdum aliquam odio, eu mollis nisl scelerisque eu. Quisque rhoncus enim in nunc maximus, sed cursus massa dapibus. Aliquam non velit ut eros tincidunt tincidunt non id lacus. Proin dapibus sapien est, vitae accumsan enim porttitor ac. Duis ultrices neque tempor nibh fermentum maximus. Vestibulum porttitor tortor sit amet consequat pellentesque.

Praesent a sodales quam. Vivamus dolor lectus, iaculis vel nunc in, convallis ultrices quam. Praesent tempus tempor tortor, ac ullamcorper urna pretium eu. Etiam nec sem a nisl hendrerit ultricies. Integer laoreet consectetur diam eget mattis. Nulla facilisis molestie interdum. Vestibulum iaculis condimentum dolor sed pulvinar.

Fusce pulvinar elementum mauris non ullamcorper. Nulla facilisi. Quisque maximus porta turpis eu vulputate. Pellentesque nec est id nisi pellentesque semper. Integer vel imperdiet erat. Pellentesque congue velit eget metus efficitur, a malesuada nisl aliquet. Nulla euismod pellentesque semper. Aliquam sodales accumsan egestas. Vivamus ut lobortis dolor, at facilisis magna. Sed ultrices cursus dapibus.

Vestibulum quis ex ac magna facilisis efficitur. Donec non eros ut ex iaculis pulvinar. Sed convallis lectus orci, non pellentesque nisl bibendum sed. Aliquam ut lobortis neque. Sed tempor odio non augue gravida commodo. Mauris aliquet, sapien ut posuere ultricies, est enim suscipit ligula, ut accumsan odio nunc sed diam. Donec at orci pulvinar, pharetra nisl in, fermentum massa. Curabitur sed bibendum arcu. Pellentesque suscipit, ligula et molestie mattis, elit lacus cursus ipsum, nec cursus mauris magna in lorem. Nam in erat sem. Donec pulvinar, est id facilisis pulvinar, tortor diam pellentesque mauris, sed ultricies nulla eros non massa.

Ut fermentum ex libero, a maximus purus euismod in. Sed non nisi non metus volutpat sollicitudin. Vestibulum massa elit, suscipit in diam et, pharetra luctus enim. Vivamus dolor est, tristique eget eros vel, vulputate congue augue. Cras viverra tellus non nisl rutrum semper. Morbi id pretium purus. Sed nec vehicula ipsum. Suspendisse vel sapien quam. Mauris pharetra viverra tellus ut convallis. Nunc imperdiet sagittis ipsum consectetur tristique.
"
```

---

# Nube de palabras

```{r}

# devtools::install_github("https://github.com/bradleyboehmke/harrypotter")
# library(harrypotter)
# 
# hppalabras <- harrypotter::chamber_of_secrets[1] %>%
#   as_tibble() %>%
#   unnest_tokens(word, value) %>%
#   group_by(word) %>%
#   count()
```

---

# Nube de palabras

```{r}
# hppalabras_filtradas <- hppalabras %>%
#   anti_join(stop_words, by = c("word" = "word"))
#   
# hppalabras_filtradas_top <- hppalabras_filtradas %>%
#   arrange(desc(n)) %>%
#   ungroup() %>%
#   slice_head(n = 30)
#   
# wordcloud2(hppalabras_filtradas_top)
```

---

# Nube de palabras

```{r}
# mi_texto <- readChar("palabras.txt", file.info("palabras.txt")$size)
# 
# mi_texto <- mi_texto %>%
#   as_tibble() %>%
#   unnest_tokens(word, value) %>%
#   group_by(word) %>%
#   count()
# 
# wordcloud2(mi_texto)
```


---
class: middle, inverse, center

# Otros gr√°ficos
---


# Datos: `gapminder` üåê

```{r eval=FALSE}
gapminder::gapminder
```

Exrtacto de los datos de Gapminder sobre expectativa de vida, GDP (Gross Domestic Product - Producto Interior Bruto en U$) per capita, y poblaci√≥n por pa√≠s.

- `country  `: pa√≠s `<fct>`
- `continent`: continente `<fct>`
- `year     `: a√±o `<int>`
- `lifeExp  `: expectativa de vida `<dbl>`
- `pop      `: poblaci√≥n `<int>`
- `gdpPercap`: Producto Interior Bruto per capita en U$ `<dbl>`

.foortnote[Gapminder is an independent Swedish foundation with no political, religious or economic affiliations. Gapminder fights devastating misconceptions and promotes a fact-based worldview everyone can understand.]
---

# Gapminder üåê

```{r echo=FALSE, tidy=FALSE}
rmarkdown::paged_table(penguins)
```

---

# Puntos conectados

El objetivo es obtener este gr√°fico:

```{r, fig.height=4}
ggplot(gapminder %>% 
         filter(country %in% c("Spain", "China", "United States")), 
       aes(year, gdpPercap)) +
  geom_line(aes(group = country)) +
  geom_point(aes(color = country))
```


---

# Animaci√≥n con `gganimate`

```{r fig.height=3}
ggplot(gapminder %>% 
         filter(country %in% c("Spain", "China", "United States")), 
       aes(year, gdpPercap)) +
  geom_line(aes(group = country)) +
  geom_point(aes(color = country)) +
  transition_reveal(year)
```

.footnote[Referencia a otros ejemplos: https://www.r-graph-gallery.com/287-smooth-animation-with-tweenr.html]

---

# T√≠tulo din√°mico

```{r fig.height=3}
ggplot(gapminder %>% 
         filter(country %in% c("Spain", "China", "United States")), 
       aes(year, gdpPercap)) +
  geom_line(aes(group = country)) +
  geom_point(aes(color = country)) +
  transition_reveal(year) +
  labs(title = "A√±o: {frame_along}")
  
```


---
class: inverse, middle, center

# Gr√°ficos animados con `plotly`

---

# `plotly`

```{r fig.height=3}
p <- ggplot(penguins, aes(sex)) +
  geom_bar()
ggplotly(p)
```

---

# `plotly`

```{r fig.height=3}
plot2 <- ggplot(penguins, aes(x = bill_length_mm, 
                     y = bill_depth_mm)) +
  geom_point(aes(fill = island, 
                 shape = species,
                 color = sex),
             size = 5,
             alpha = .6) +
  geom_text(aes(label = ifelse(sex == "male", "M", "F"))) +
  scale_shape_manual(values = c(21,22,23)) +
  scale_color_manual(values = c("white", "grey", "black")) +
  scale_fill_manual(values = c(Biscoe="red", 
                               Dream="blue", 
                               Torgersen="green")) +
  guides(fill = guide_legend(override.aes = list(color = c(Biscoe="red", 
                                                           Dream="blue", 
                                                           Torgersen="green"))))
ggplotly(plot2)
```


---

# `plotly`

```{r fig.height=3}
plot_base <- ggplot(penguins, aes(x = bill_length_mm, 
                     y = bill_depth_mm)) +
  geom_point()

anim <- plot_base +
  transition_states(species,
                    transition_length = 5,
                    state_length = 2)

anim + enter_fade()
```



---

# `plotly`

```{r fig.height=3}
anim <- ggplot(penguins, aes(x = bill_length_mm, 
                     y = bill_depth_mm)) +
  geom_point(aes(color = species)) +
  labs(title = "{closest_state}") +
  transition_states(species, 
                    transition_length = 1, 
                    state_length = 2)

#anim_save("miarchivo.gif")
```

---

# `plotly`

```{r fig.height=3}
ggplot(gapminder, aes(gdpPercap, lifeExp, 
                      size = pop,
                      color = country)) +
  geom_point(alpha = 0.7, show.legend = FALSE) +
  facet_wrap(~continent) +
  scale_x_log10() +
  scale_size(range = c(2, 12)) +
  scale_color_manual(values = country_colors) +
  labs(title = "A√±o: {frame_time}",
       x = "GDP per capita",
       y = "Life expectancy") +
  transition_time(year)
```

---
class: middle, inverse, center

# Recursos adicionales

---

# Recursos adicionales

- Extensiones de ggplot: https://exts.ggplot2.tidyverse.org/gallery/
- @elartedeldato
- https://twitter.com/andrewheiss/status/1390704334795677703?s=21


---
class: middle, center

# Tarea

---

# Tarea

Para superar el curso, es necesaria la entrega de la siguiente tarea:

- Elegir un conjunto de datos de un paquete o externo
  - En este [enlace](https://github.com/rfordatascience/tidytuesday) encontrar√°s muchos conjuntos de datos de todo tipo que puedes utilizar.
- Crear tres gr√°ficos con al menos cinco capas cada uno.
- Justificar la creaci√≥n de estos gr√°ficos: 
  - ¬øQu√© quieren mostrar? 
  - ¬øPor qu√© se ha elegido ese tipo de gr√°fico? 
  - ¬øPor qu√© se han elegido esas aesthetics para mapear las variables y no otras?

- Entregar:
  - Archivo `.R` con el c√≥digo generado y archivo de datos en caso de que el script no los descargue de forma remota.
  - Explicaci√≥n de la motivaci√≥n tras los gr√°ficos generados (en un archivo pdf independiente o como comentarios de c√≥digo del archivo `.R`).

**DEADLINE**: Mi√©rcoles 21 de Julio 2021, 23:59.